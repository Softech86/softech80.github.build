
    <html>
    <head>
      <style>
      html, body {
        font-family: songke;
      }
    
      @font-face {
        font-family: songke;
        font-style: normal;
        font-weight: 500;
        src: url(./songke-content.ttf);
      }
    </style>
    </head>
    <body>
    日常/request-ok 结构.md# request-ok 结构

## Activities 

- 登录
- 

### 登录
用户填写表单提交登录，登录成功跳转主页

### 主页
显示用户监听页面的列表
每个页面的历史扫描情况
用户出现
对监听页面用户可以进行编辑或查找

### 查找
在主页搜索栏输入关键字查找记录


## Models
### User
用户个人信息
- name
- pages：用户添加的 pages，User 跟 Page关系多对多

### Page
待扫描页面的信息
- url
- title
- records：record 的列表
- header
- frequency：扫描间隔时间（秒）
- author：修改者
- modify-log：配置信息

### Record
一条扫描记录
- reqSent：发出的请求列表
- reqReceived：收到的请求列表
- startTimeStamp：扫描创建时间
- finishTimeStamp：扫描结束时间
- match：bool，收发请求是否一一对应

### RequestSent
一条发出的请求
- requestId
- url
- header

### RequestReceived
一条收到的请求
- requestId
- status：状态码
- statusText：状态文本
- url：请求的 url
- response-header
- time：请求耗时

### Relation维护用户和页面间多对多关系

日常/测试文章.md# title

## subtitle

hello *there*
  * w
  * x
  * y
  * z

## node
```node
function () {
  return 1; // what?
}
```

## c++
```c++
#include <iostream>
using namespace std;
int main () {
  cout << 'hello world';
  return 0
}
```

## image
![here](scr.png)
![here](blog.svg)
![vuejob](https://zh.nuxtjs.org/vuejobs.png)

## link
[here](scr.png)
日常/第一章复习笔记.md## 第一章

### 术语挑选

- **虚拟机**：用软件实现的机器。

- **翻译、解释**

- **计算机系统结构**：传统机器程序员所看到的计算机属性，即概念性结构与功能特性。

- **透明性**：在计算机技术中，把这种本来存在的事物或属性，但从某种角度看又好像不存在的概念称为透明性。

- **计算机组成**：计算机系统结构的逻辑实现，包含物理机器级中的数据流和控制流的组成以及逻辑设计等。着眼于物理机器级內**各事件的排序方式和控制方式、各部件的功能和部件之间的联系**

- **计算机实现**：计算机组成的物理实现。着眼于**器件**和**微组装技术**。

- **Amdahl定律**：当对一个系统中的某个部件进行改进后，所能获得的整个系统性能的提高，受限于该部件的执行时间占总执行时间的百分比。

- **系列机**：由同一厂家生产的具有相同系统结构、但具有不同组成和实现的一系列不同型号的计算机。

- **模拟**，**仿真**

- **并行性**：计算机系统在同一时刻或者同一时间间隔内进行多种运算或操作。只要在时间上相互重叠，就存在并行性。它包括同时性与并发性两种含义。

  - **时间重叠**：在并行性概念中引入<u>时间因素</u>，让多个处理过程在时间上相互错开，轮流重叠地使用同一套硬件设备的各个部分，以加快硬件周转而赢得速度。

    **资源重复**：在并行性概念中引入<u>空间因素</u>，以数量取胜。通过重复设置硬件资源，大幅度地提高计算机系统的性能。

    **资源共享**：这是一种软件方法，它使多个任务按一定时间顺序轮流使用同一套硬件设备。

- **异构型多处理机系统**：由多个不同类型、至少担负不同功能的处理机组成，它们按照作业要求的顺序，利用时间重叠原理，依次对它们的多个任务进行加工，各自完成规定的功能动作。

  **同构型多处理机系统**：由多个同类型或至少担负同等功能的处理机组成，它们同时处理同一作业中能并行执行的多个任务。



### 1.1

2002年后，计算机性能下降的原因：

- 功耗问题
- 可开发的指令集并行性很少
- 存储器访问速度提升缓慢

因而-> **多核**， 开发**线程级并行** 和 **数据集并行**



### 1.2 系统结构概念

按照**计算机语言**的角度->计算机系统按功能划分成 **多级层次结构**，每一层以一种语言为特征。

按照计算机系统的多级层次结构，不同级程序员看到的计算机具有不同的属性。

**广义的系统结构定义**：指令集结构、组成、硬件

- 传统机器语言级程序员看到的属性：
  - 指令系统、数据表示、寻址规则、寄存器定义、终端系统、工作转台的定义和切换、存储系统、信息保护、IO结构

计算机系统结构概念的**实质**：确定软、硬件的界面

**计算机组成、实现**：一种体系结构可以有多种组成，一种组成可以有多种物理实现。

计算机系统结构的**分类**：

- Flynn：**指令流**和**数据流**的多倍性进行分类

  指令流：计算机执行的指令序列。

  数据流：由指令条用的数据序列

  多倍性：在系统受限的部件下，同时处于同一执行阶段的指令和数据的最大数目。

  - SISD SIMD MISD MIMD

- 冯氏：系统最大并行度（m*n）



### 1.3 定量分析技术

4个定量原理：

1. 经常性时间为重点。

   对经常发生的情况采用优化方法的原则进行选择，得到更多总体上的改进。

   **优化**：分配更多资源、达到更高性能或者分配更多的电能？

2. Amdahl定律

   加快某部件的执行速度对于系统总体性能的提升，受限于该部件执行时间占总执行时间的百分比。

   概念：加速比、可改进比例 \< 1、部件加速比 \>1

   **一种性能改进的递减规则**

   **重要推论**：如果只针对整个任务的一部分进行改进和优化，那么所获得的加速比不超过
   $$

   $$

   $$
   \frac{1}{1-可改进比例}
   $$




3. CPU性能公式

   CPU时间 = IC * CPI * 时钟周期时间

   CPU时钟周期数 = $\sum (CPI_i \times IC_i)$

   **CPI = $\sum (CPI_i \times \frac{IC_i}{IC})$**

4. 程序的局部性原理

   程序执行时所访问的存储器地址分布不是随机

   的，而是相对地簇聚

   - 时间局部性
   - 空间局部性

性能评测：

1. 执行时间：

   - 全部时间
   - CPU时间：CPU执行所给定的程序所花费的时间，不包含I/O等待时间以及运行其他程序的时间。
     - 用户CPU时间
     - 系统CPU时间：用户程序运行期间操作系统耗费的CPU时间

   吞吐率：单位时间的任务量

2. 基准测试程序

   基准测试程序套件: SPEC系列

   事务处理性能测试基准程序（TP）



### 1.4 发展

冯诺依曼结构：

1. 存储程序原理的**基本点**：**指令驱动**
2. 主要特点：
   - 以运算器为中心
   - 在存储器中，指令和数据同等对待
   - 存储器是按地址访问、按顺序线性编址的一堆结构，每个单元的位数是固定的
   - 指令执行顺序
   - 指令=操作码+地址码
   - 二进制表示、运算
3. 改进
   - 输入输出方式：
     - 程序控制：等待、中断
     - DMA
     - IO处理机
   - 并行处理
   - 存储器
   - 指令集

软件的可移植性：

- 系列机

  **向后兼容**是系列机的**根本特征**。

- 模拟、仿真

- 统一高级语言

摩尔定律：集成电路芯片晶体管数 18个月翻番

**应用需求** 是 促使计算机系统结构发展的最根本的**动力**

计算机性能随时间下移



### 1.5 并行性

并行性：计算机系统在同一时刻或同一时间间隔内进行多种运算或操作。

- 同时性：时刻
- 并发行：时间间隔

处理数据的角度：字串位串->全并行（字并位并）

执行程序的角度：指令内部、指令级、现成绩、任务级、作业级

- 三种途径：

  - 时间重叠（主导作用）

    - 部件功能专用化->流水线

  - 资源重复

    - 多提存储器
    - 多操作部件->指令集并行

  - 资源共享

    单处理机模拟多处理机的功能（虚拟机）

    - 分时系统

3种多处理机：

- 异构型多处理机

  不用类型、至少担负不同功能的处理机组成，按照要求的顺序，**利用时间重叠原理**，多个任务进行加工，完成**各自功能**。

- 同构性多处理机

  同类型，至少担负同种功能的，同时处理统一作业中能并行的多个任务。

- 分布式系统日常/第三章复习笔记.md## 第三章

### 名词解释

- **流水线**：将一个重复的时序过程，分解成为若干个子过程，而每一个子过程都可有效地在其专用功能段上与其它子过程同时执行

- **数据相关**：考虑两条指令i和j，*i*在*j*的前面，如果下述条件之一成立，则称指令*j*与指令i数据相关： 

  （1）指令*j*使用指令*i*产生的结果；

  （2）指令*j*与指令*k*数据相关，而指令*k*又与指令*i*数据相关。

- **名相关**：如果两条指令使用了相同的名，但是它们之间并没有数据流动，则称这两条指令存在名相关。

- **反相关**：考虑两条指令*i*和*j*，*i*在*j*的前面，如果指令*j*所写的名与指令*i*所读的名相同，则称指令*i*和*j*发生了反相关。

- **输出相关**：考虑两条指令*i*和*j*，*i*在*j*的前面，如果指令*j*和指令*i*所写的名相同，则称指令*i*和*j*发生了输出相关。

- **结构冲突**：因硬件资源满足不了指令重叠执行的要求而发生的冲突。

- **数据冲突**：当指令在流水线中重叠执行时，因需要用到前面指令的执行结果而发生的冲突。

- **控制冲突**：流水线遇到分支指令或其它会改变PC值的指令所引起的冲突。

- **定向**：用来解决写后读冲突的。

- **写后读冲突**

  **写后写冲突**、**读后写冲突** （经典5段不会出现的）

- **链接技术**：具有先写后读相关的两条指令，在不出现功能部件冲突和Vi冲突的情况下，可以把功能部件链接起来进行流水处理，以达到加快执行的目的。

- **分段开采**：当向量的长度大于向量寄存器的长度时，必须把长向量分成长度固定的段，然后循环分段处理，每一次循环只处理一个向量段。

### 3.1 流水线基本概念

- 流水线技术

  - 流水线的**级**或**段**
  - 流水线的**深度**

- 流水线特点

  - 分解为多个子过程，专门的功能部件

  - 各段时间相等

    时间长的段成为流水线的**瓶颈**

  - 功能部件后面又一个缓冲寄存器（锁存器）-> **流水寄存器**

    **作用**：相邻两段之间<u>传送数据</u>，保证提供后面要用到的数据，各段的处理工作<u>相互隔离</u>

  - 大量的时序过程，才能发挥效率

  - **通过时间**和**排空时间**

    第一个和最后一个，从进入到流出所需要的时间

- 分类

  - 单功能、多功能（ASC）

  - 静态流水线、动态流水线

  - 部件级流水线（运算操作流水线）

    处理机级流水线（指令流水线）

    处理机间流水线（宏流水线）

  - 线性流水线、非线性流水线

    - 非线性 调度问题，争用流水段

  - 顺序流水线、乱序流水线（无序、错序、异步）

  - 标量处理机、向量处理机

### 3.2 性能指标

- **吞吐率TP** 

  单位时间完成的任务数量或输出结果的数量

  - 实际，最大

  解决**流水线瓶颈**的方法

  - **细分瓶颈段**
  - **重复设置瓶颈段**

- **加速比S**

  不使用流水线和使用流水线所用的时间比

  最大加速比 = k

  流水线的段数并非越多越好。

- **效率E**

  流水线中设备实际使用时间与整个运行时间的比值。（数面积）

问题：

- 瓶颈问题

- 额外开销

  - 流水寄存器延迟

    建立时间：信号到达前，寄存器保持稳定的时间

    传输延迟：信号到达后，寄存器输出可用的时间

  - 时钟偏移开销

    时钟到达各流水寄存器的最大差值时间

  时钟周期小到与额外开销相同时，流水已没有意义。

- 冲突问题—最重要的问题之一

### 3.3 相关与冲突

5段RICS：IF -> ID -> EX -> MEM -> WB

- **相关**

  两条指令之间在某种依赖关系

  - 数据相关

  - 名相关 （i写j读）

    相同的名，但没有数据流动

    - 反相关 （i读j写）
    - 输出相关（i写j写）

  - 控制相关

- **流水线冲突**

  - **结构冲突**

    原因：

    - 功能部件不是完全流水的
    - 资源份数不够

    访存冲突：

    1. 插入暂停周期（流水线气泡）

    2. 设置独立的指令、数据存储器

       或者独立的指令、数据Cache

    语序结构冲突的存在：成本

  - **数据冲突**

    靠太近

    - RAW 写后读

    - WAW 写后写

      只发生在：

      - 流水线不止一个段可以写
      - 当前停顿，后续可以前进

      5段里面不存在的

    - WAR 读后写

      只发生在：

      - 有的写提前、有的读滞后
      - 重新排序

      依然不存在的

    **定向技术**

    - 将计算结果从其**产生的地方**直接送到其他指令**需要它的地方**，那么就可以避免停顿

    - 然而，定向并不能解决所有问题，比如：LD->DADD

      增加**互锁硬件**，插入暂停

      作用：检测发现数据冲突，使流水线停顿

    **指令调度**／**流水线调度**

    让编译器重新组织顺序

  - **控制冲突**

    简单方法：冻结、排空（3个周期的延迟）

    **分支延迟**：由分支指令引起的

    假设：**判断转移成功**和**确定目标地址**都在**ID**段完成->分支延迟为一个周期

    3种编译器减少延迟的方法：（静态）

    - **预测分支失败**

      - 确定失败，不跳转，一切正常

      - 确定成功，跳转，之前的指令转化为空操作

        保重能够退回原先的状态

    - **预测分支成功**

      - 前提：先知道跳转的目标地址

        对5段流水线没有任何好处

    - **延迟分支**

      延迟分支指令的执行时间，加上**延迟槽**

      - 从前调度
      - 从目标出调度
      - 从失败处调度

      **分支取消机制**

### 3.4 实现--MIPS

- 流水寄存器

- 所有的数据冲突可以在ID段检测到，流出ID前暂停->互锁

  load互锁

  检测到RAW冲突，IF、ID段的指令不再前进：

  - ID/EX.IR中的操作吗改为0
  - IF/ID寄存器的内容回送到自己的入口

- ID段增设加法器

- 条件测试移到ID段

- 结果送回IF段的MUX1

  ​日常/第二章复习笔记.md## 第二章

### 2.1

存储操作数的操作单元：堆栈、累加器、通用寄存器组

通用寄存器分为：RM结构、RR结构、MM结构（很少用）（R— 寄存器、M存储器）

通用寄存器优势（灵活性、提高性能方面）：

- 寄存器的访问速度比存储器快
- 对编译器而言，能更加容易、有效地分配和使用寄存器
- 寄存器可以用来存放变量

根据ALU指令的操作数个数，对通用寄存器型指令集进行进一步细分：

- ALU指令的操作数个数
- ALU指令的存储器操作数个数
- 具体表 28页表2.2

| 指令集结构类型 | 优点                                       | 缺点                         |
| ------- | ---------------------------------------- | -------------------------- |
| RR      | 指令字长固定，指令结构简洁，执行时钟周期数相近                  | 指令条数多，目标代码不够紧凑，程序占用空间大     |
| RM      | 可以在ALU指令中直接对存储器操作数进行引用，容易对指令进行编码，目标代码比较紧凑 | 两个操作数不对称，限制寄存器个数，执行时钟周期差别大 |
| MM      | 目标代码紧凑，不需要寄存器保存变量                        | 指令字长变化大，每条指令工作差别大，存储器频繁访问  |

### 2.2

寻址方式：一种指令集结构如何确定所有访问的数据的地址

有效地址：由寻址方式确定的实际存储器地址

表2.4 操作数寻址方式

多种寻址方式：减少程序的指令条数 增加复杂度、CPI

立即数寻址方式、偏移寻址方式频度最高 一些性质31-32页

### 2.3

确定功能由什么实现，考虑的因素：速度、成本、灵活性

- 硬件：速度快、成本高、灵活性低
- 软件：速度低、成本低、灵活性高

指令集基本要求：

- 完整性
  - 有限可用的存储空间内，对于任何可解问题编程，指令集提供的指令足够使用
  - 功能齐全、使用方便
- 规整性
  - 对称性：所有与指令集相关的存储单元使用、操作码设置都是对称的
  - 均匀性：对各种不同的操作数类型、字长、操作种类和数据存储单元，指令设置要同等对待
- 高效率
  - 指令的执行速度快、使用频率高
- 兼容性


CISC指令集：

- 追求目标：强化指令功能、减少指令条数，以达到提高性能的目的
- 增强指令功能从以下几个方面：
  - 面向目标程序增强指令功能
    - 面向目标程序优化指令集释提高计算机性能的最直接的方法
    - 增强运算型指令功能
    - 增强数据传送指令的功能
    - 增强程序控制指令的功能
  - 面向高级语言的优化实现来改进指令集
    - 高级语言与一般的机器语言的语义差距非常大。一方面：编译器本身比较复杂；二方面：编译生成的目标代码比较难以达到好的优化
    - 增强对高级语言和编译器的支持（35页）
    - 使用高级语言计算机（36页）
    - 面向操作系统的优化实现改进指令集（36-37页）

CISC指令集存在的问题：

- 各种指令的使用频度相差悬殊，许多指令很少用到
- 指令集庞大，指令条数很多，许多指令的功能又很复杂
- 许多指令操作繁杂，CPI值比较大，执行速度慢；有可能使整个程序的执行时间反而增加
- 指令功能复杂，规整性不好，不利于采用流水技术来提高性能

RISC计算机设计遵循原则：

- 指令条数少而简单，只选取使用频度很高的指令
- 采用简单而统一的指令格式，减少寻址方式。字长32位or64位
- 指令的执行在单个机器周期内完成（流水线后）
- load和store才能访问存储器，采用load-store结构
- 大多数指令都采用硬连逻辑来实现
- 强调优化编译器的作用，为高级程序语言生成优化的代码
- 充分利用流水技术

早起RISC微处理器特点：

- load-store结构
- 字长为32位
- 高效的流水技术

控制指令

- 分类
  - 跳转：无条件改变控制流指令
  - 分支：有条件改变控制流指令
- 改变控制流的指令：条件分支、跳转、过程调用、过程返回（分支占大半部分）

3种表示分支条件的主要方法

| 名称      | 方法                           | 优点            | 缺点                                |
| ------- | ---------------------------- | ------------- | --------------------------------- |
| 条件码（CC） | 检测由ALU操作设置的一些特殊位(CC)         | 自由设置分支条件      | 条件码是增设的状态；限制了指令的执行顺序（确保条件码能够顺利传送） |
| 条件寄存器   | 比较指令把比较结果放入一个寄存器，需要的时候检测该寄存器 | 简单            | 占用了一个寄存器                          |
| 比较与分支   | 比较操作作为分支指令的一部分，通常这种比较是受限制的   | 一条指令（非两条）实现分支 | 流水方式时，该指令的操作太多，无法在一拍内做完           |

转移地址的表示（显式）

- 最常用的方法：指令中提供一个偏移量，偏移量加程序计数器(PC) — — PC相对寻址
  - 优点
    - 有效减少表示该目标地址所需的位数(一般目标地址离当前指令很近)
    - 位置无关(代码可以被转载到主存的任意位置)
  - 4～8位偏移量字段足够表示大多数转移目标地址

过程调用和返回

- 除了改变控制流，还要保存机器状态、返回地址(专门的链接寄存器、堆栈)
- 过去：专门的保存机制
- 现在：编译器生成load和store指令来保存或恢复寄存器

### 2.4

数据表示：计算机硬件能够直接识别、指令集可以直接调用的数据类型

数据结构：软件进行处理和实现的各种数据类型

如何确定数据表示：系统结构设计者要解决的问题（软硬件取舍折中）

表示操作数类型的方法

- 指令中操作码指定操作数的类型 常用
- 带标志符的数据表示 少见
- 41页

操作数大小

- 字节 8位；半字 16位；字 32位；双字 64 位
- 字符 ASCII码 一个字节
- 整数 二进制补码 字节、半字、字
- 浮点操作数 单精度浮点数 1个字；双精度浮点数 双字
- 十进制操作数类型 41页

访问频度 单字、双字的高

### 2.5

指令组成：操作码、地址码

指令格式的设计：确定指令字的编码方式，操作码和地址码的编码和表示方式

操作码：

- Huffman码，变长，不规整，不利于硬件处理
- 固定长度操作码，保证译码速度

寻址方式：

- 编码于操作码中，操作码描述寻址方式。load-store结构，寻址方式少
- 专门的地址描述符。多种寻址方式，指令操作数多

考虑因素：

- 寄存器个数、寻址方式的数目对指令平均字长的影响、目标代码大小的影响
- 指令易于硬件处理，特别是流水实现
- 指令字长是字节(8位)的整数倍

编码格式

- 变长编码格式
  - 寻址方式和操作种类很多时候，最好
  - 最少的二进制位来表示目标代码
  - 可能使各条指令的字长和执行时间差异很大
- 固定长度编码格式
  - 操作类型、寻址方式一起编码到操作码当中
  - 寻址方式和操作类型很少时，最好
  - 降低译码的复杂度，提高译码速度
  - RISC指令集采用该编码格式
- 混合型编码格式
  - 提供若干种固定的指令字长
  - 减少目标代码长度、降低译码复杂度日常的副本/request-ok 结构.md# request-ok 结构

## Activities 

- 登录
- 

### 登录
用户填写表单提交登录，登录成功跳转主页

### 主页
显示用户监听页面的列表
每个页面的历史扫描情况
用户出现
对监听页面用户可以进行编辑或查找

### 查找
在主页搜索栏输入关键字查找记录


## Models
### User
用户个人信息
- name
- pages：用户添加的 pages，User 跟 Page关系多对多

### Page
待扫描页面的信息
- url
- title
- records：record 的列表
- header
- frequency：扫描间隔时间（秒）
- author：修改者
- modify-log：配置信息

### Record
一条扫描记录
- reqSent：发出的请求列表
- reqReceived：收到的请求列表
- startTimeStamp：扫描创建时间
- finishTimeStamp：扫描结束时间
- match：bool，收发请求是否一一对应

### RequestSent
一条发出的请求
- requestId
- url
- header

### RequestReceived
一条收到的请求
- requestId
- status：状态码
- statusText：状态文本
- url：请求的 url
- response-header
- time：请求耗时

### Relation维护用户和页面间多对多关系

日常的副本/request-ok 结构的副本 2.md# request-ok 结构

## Activities 

- 登录
- 

### 登录
用户填写表单提交登录，登录成功跳转主页

### 主页
显示用户监听页面的列表
每个页面的历史扫描情况
用户出现
对监听页面用户可以进行编辑或查找

### 查找
在主页搜索栏输入关键字查找记录


## Models
### User
用户个人信息
- name
- pages：用户添加的 pages，User 跟 Page关系多对多

### Page
待扫描页面的信息
- url
- title
- records：record 的列表
- header
- frequency：扫描间隔时间（秒）
- author：修改者
- modify-log：配置信息

### Record
一条扫描记录
- reqSent：发出的请求列表
- reqReceived：收到的请求列表
- startTimeStamp：扫描创建时间
- finishTimeStamp：扫描结束时间
- match：bool，收发请求是否一一对应

### RequestSent
一条发出的请求
- requestId
- url
- header

### RequestReceived
一条收到的请求
- requestId
- status：状态码
- statusText：状态文本
- url：请求的 url
- response-header
- time：请求耗时

### Relation维护用户和页面间多对多关系

日常的副本/request-ok 结构的副本 3.md# request-ok 结构

## Activities 

- 登录
- 

### 登录
用户填写表单提交登录，登录成功跳转主页

### 主页
显示用户监听页面的列表
每个页面的历史扫描情况
用户出现
对监听页面用户可以进行编辑或查找

### 查找
在主页搜索栏输入关键字查找记录


## Models
### User
用户个人信息
- name
- pages：用户添加的 pages，User 跟 Page关系多对多

### Page
待扫描页面的信息
- url
- title
- records：record 的列表
- header
- frequency：扫描间隔时间（秒）
- author：修改者
- modify-log：配置信息

### Record
一条扫描记录
- reqSent：发出的请求列表
- reqReceived：收到的请求列表
- startTimeStamp：扫描创建时间
- finishTimeStamp：扫描结束时间
- match：bool，收发请求是否一一对应

### RequestSent
一条发出的请求
- requestId
- url
- header

### RequestReceived
一条收到的请求
- requestId
- status：状态码
- statusText：状态文本
- url：请求的 url
- response-header
- time：请求耗时

### Relation维护用户和页面间多对多关系

日常的副本/request-ok 结构的副本.md# request-ok 结构

## Activities 

- 登录
- 

### 登录
用户填写表单提交登录，登录成功跳转主页

### 主页
显示用户监听页面的列表
每个页面的历史扫描情况
用户出现
对监听页面用户可以进行编辑或查找

### 查找
在主页搜索栏输入关键字查找记录


## Models
### User
用户个人信息
- name
- pages：用户添加的 pages，User 跟 Page关系多对多

### Page
待扫描页面的信息
- url
- title
- records：record 的列表
- header
- frequency：扫描间隔时间（秒）
- author：修改者
- modify-log：配置信息

### Record
一条扫描记录
- reqSent：发出的请求列表
- reqReceived：收到的请求列表
- startTimeStamp：扫描创建时间
- finishTimeStamp：扫描结束时间
- match：bool，收发请求是否一一对应

### RequestSent
一条发出的请求
- requestId
- url
- header

### RequestReceived
一条收到的请求
- requestId
- status：状态码
- statusText：状态文本
- url：请求的 url
- response-header
- time：请求耗时

### Relation维护用户和页面间多对多关系

日常的副本/测试文章.md# title

## subtitle

hello *there*
  * w
  * x
  * y
  * z

## node
```node
function () {
  return 1; // what?
}
```

## c++
```c++
#include <iostream>
using namespace std;
int main () {
  cout << 'hello world';
  return 0
}
```

## image
![here](scr.png)
![here](blog.svg)
![vuejob](https://zh.nuxtjs.org/vuejobs.png)

## link
[here](scr.png)
日常的副本/测试文章的副本 2.md# title

## subtitle

hello *there*
  * w
  * x
  * y
  * z

## node
```node
function () {
  return 1; // what?
}
```

## c++
```c++
#include <iostream>
using namespace std;
int main () {
  cout << 'hello world';
  return 0
}
```

## image
![here](scr.png)
![here](blog.svg)
![vuejob](https://zh.nuxtjs.org/vuejobs.png)

## link
[here](scr.png)
日常的副本/测试文章的副本 3.md# title

## subtitle

hello *there*
  * w
  * x
  * y
  * z

## node
```node
function () {
  return 1; // what?
}
```

## c++
```c++
#include <iostream>
using namespace std;
int main () {
  cout << 'hello world';
  return 0
}
```

## image
![here](scr.png)
![here](blog.svg)
![vuejob](https://zh.nuxtjs.org/vuejobs.png)

## link
[here](scr.png)
日常的副本/测试文章的副本.md# title

## subtitle

hello *there*
  * w
  * x
  * y
  * z

## node
```node
function () {
  return 1; // what?
}
```

## c++
```c++
#include <iostream>
using namespace std;
int main () {
  cout << 'hello world';
  return 0
}
```

## image
![here](scr.png)
![here](blog.svg)
![vuejob](https://zh.nuxtjs.org/vuejobs.png)

## link
[here](scr.png)
日常的副本/第一章复习笔记.md## 第一章

### 术语挑选

- **虚拟机**：用软件实现的机器。

- **翻译、解释**

- **计算机系统结构**：传统机器程序员所看到的计算机属性，即概念性结构与功能特性。

- **透明性**：在计算机技术中，把这种本来存在的事物或属性，但从某种角度看又好像不存在的概念称为透明性。

- **计算机组成**：计算机系统结构的逻辑实现，包含物理机器级中的数据流和控制流的组成以及逻辑设计等。着眼于物理机器级內**各事件的排序方式和控制方式、各部件的功能和部件之间的联系**

- **计算机实现**：计算机组成的物理实现。着眼于**器件**和**微组装技术**。

- **Amdahl定律**：当对一个系统中的某个部件进行改进后，所能获得的整个系统性能的提高，受限于该部件的执行时间占总执行时间的百分比。

- **系列机**：由同一厂家生产的具有相同系统结构、但具有不同组成和实现的一系列不同型号的计算机。

- **模拟**，**仿真**

- **并行性**：计算机系统在同一时刻或者同一时间间隔内进行多种运算或操作。只要在时间上相互重叠，就存在并行性。它包括同时性与并发性两种含义。

  - **时间重叠**：在并行性概念中引入<u>时间因素</u>，让多个处理过程在时间上相互错开，轮流重叠地使用同一套硬件设备的各个部分，以加快硬件周转而赢得速度。

    **资源重复**：在并行性概念中引入<u>空间因素</u>，以数量取胜。通过重复设置硬件资源，大幅度地提高计算机系统的性能。

    **资源共享**：这是一种软件方法，它使多个任务按一定时间顺序轮流使用同一套硬件设备。

- **异构型多处理机系统**：由多个不同类型、至少担负不同功能的处理机组成，它们按照作业要求的顺序，利用时间重叠原理，依次对它们的多个任务进行加工，各自完成规定的功能动作。

  **同构型多处理机系统**：由多个同类型或至少担负同等功能的处理机组成，它们同时处理同一作业中能并行执行的多个任务。



### 1.1

2002年后，计算机性能下降的原因：

- 功耗问题
- 可开发的指令集并行性很少
- 存储器访问速度提升缓慢

因而-> **多核**， 开发**线程级并行** 和 **数据集并行**



### 1.2 系统结构概念

按照**计算机语言**的角度->计算机系统按功能划分成 **多级层次结构**，每一层以一种语言为特征。

按照计算机系统的多级层次结构，不同级程序员看到的计算机具有不同的属性。

**广义的系统结构定义**：指令集结构、组成、硬件

- 传统机器语言级程序员看到的属性：
  - 指令系统、数据表示、寻址规则、寄存器定义、终端系统、工作转台的定义和切换、存储系统、信息保护、IO结构

计算机系统结构概念的**实质**：确定软、硬件的界面

**计算机组成、实现**：一种体系结构可以有多种组成，一种组成可以有多种物理实现。

计算机系统结构的**分类**：

- Flynn：**指令流**和**数据流**的多倍性进行分类

  指令流：计算机执行的指令序列。

  数据流：由指令条用的数据序列

  多倍性：在系统受限的部件下，同时处于同一执行阶段的指令和数据的最大数目。

  - SISD SIMD MISD MIMD

- 冯氏：系统最大并行度（m*n）



### 1.3 定量分析技术

4个定量原理：

1. 经常性时间为重点。

   对经常发生的情况采用优化方法的原则进行选择，得到更多总体上的改进。

   **优化**：分配更多资源、达到更高性能或者分配更多的电能？

2. Amdahl定律

   加快某部件的执行速度对于系统总体性能的提升，受限于该部件执行时间占总执行时间的百分比。

   概念：加速比、可改进比例 \< 1、部件加速比 \>1

   **一种性能改进的递减规则**

   **重要推论**：如果只针对整个任务的一部分进行改进和优化，那么所获得的加速比不超过
   $$

   $$

   $$
   \frac{1}{1-可改进比例}
   $$




3. CPU性能公式

   CPU时间 = IC * CPI * 时钟周期时间

   CPU时钟周期数 = $\sum (CPI_i \times IC_i)$

   **CPI = $\sum (CPI_i \times \frac{IC_i}{IC})$**

4. 程序的局部性原理

   程序执行时所访问的存储器地址分布不是随机

   的，而是相对地簇聚

   - 时间局部性
   - 空间局部性

性能评测：

1. 执行时间：

   - 全部时间
   - CPU时间：CPU执行所给定的程序所花费的时间，不包含I/O等待时间以及运行其他程序的时间。
     - 用户CPU时间
     - 系统CPU时间：用户程序运行期间操作系统耗费的CPU时间

   吞吐率：单位时间的任务量

2. 基准测试程序

   基准测试程序套件: SPEC系列

   事务处理性能测试基准程序（TP）



### 1.4 发展

冯诺依曼结构：

1. 存储程序原理的**基本点**：**指令驱动**
2. 主要特点：
   - 以运算器为中心
   - 在存储器中，指令和数据同等对待
   - 存储器是按地址访问、按顺序线性编址的一堆结构，每个单元的位数是固定的
   - 指令执行顺序
   - 指令=操作码+地址码
   - 二进制表示、运算
3. 改进
   - 输入输出方式：
     - 程序控制：等待、中断
     - DMA
     - IO处理机
   - 并行处理
   - 存储器
   - 指令集

软件的可移植性：

- 系列机

  **向后兼容**是系列机的**根本特征**。

- 模拟、仿真

- 统一高级语言

摩尔定律：集成电路芯片晶体管数 18个月翻番

**应用需求** 是 促使计算机系统结构发展的最根本的**动力**

计算机性能随时间下移



### 1.5 并行性

并行性：计算机系统在同一时刻或同一时间间隔内进行多种运算或操作。

- 同时性：时刻
- 并发行：时间间隔

处理数据的角度：字串位串->全并行（字并位并）

执行程序的角度：指令内部、指令级、现成绩、任务级、作业级

- 三种途径：

  - 时间重叠（主导作用）

    - 部件功能专用化->流水线

  - 资源重复

    - 多提存储器
    - 多操作部件->指令集并行

  - 资源共享

    单处理机模拟多处理机的功能（虚拟机）

    - 分时系统

3种多处理机：

- 异构型多处理机

  不用类型、至少担负不同功能的处理机组成，按照要求的顺序，**利用时间重叠原理**，多个任务进行加工，完成**各自功能**。

- 同构性多处理机

  同类型，至少担负同种功能的，同时处理统一作业中能并行的多个任务。

- 分布式系统日常的副本/第一章复习笔记的副本 2.md## 第一章

### 术语挑选

- **虚拟机**：用软件实现的机器。

- **翻译、解释**

- **计算机系统结构**：传统机器程序员所看到的计算机属性，即概念性结构与功能特性。

- **透明性**：在计算机技术中，把这种本来存在的事物或属性，但从某种角度看又好像不存在的概念称为透明性。

- **计算机组成**：计算机系统结构的逻辑实现，包含物理机器级中的数据流和控制流的组成以及逻辑设计等。着眼于物理机器级內**各事件的排序方式和控制方式、各部件的功能和部件之间的联系**

- **计算机实现**：计算机组成的物理实现。着眼于**器件**和**微组装技术**。

- **Amdahl定律**：当对一个系统中的某个部件进行改进后，所能获得的整个系统性能的提高，受限于该部件的执行时间占总执行时间的百分比。

- **系列机**：由同一厂家生产的具有相同系统结构、但具有不同组成和实现的一系列不同型号的计算机。

- **模拟**，**仿真**

- **并行性**：计算机系统在同一时刻或者同一时间间隔内进行多种运算或操作。只要在时间上相互重叠，就存在并行性。它包括同时性与并发性两种含义。

  - **时间重叠**：在并行性概念中引入<u>时间因素</u>，让多个处理过程在时间上相互错开，轮流重叠地使用同一套硬件设备的各个部分，以加快硬件周转而赢得速度。

    **资源重复**：在并行性概念中引入<u>空间因素</u>，以数量取胜。通过重复设置硬件资源，大幅度地提高计算机系统的性能。

    **资源共享**：这是一种软件方法，它使多个任务按一定时间顺序轮流使用同一套硬件设备。

- **异构型多处理机系统**：由多个不同类型、至少担负不同功能的处理机组成，它们按照作业要求的顺序，利用时间重叠原理，依次对它们的多个任务进行加工，各自完成规定的功能动作。

  **同构型多处理机系统**：由多个同类型或至少担负同等功能的处理机组成，它们同时处理同一作业中能并行执行的多个任务。



### 1.1

2002年后，计算机性能下降的原因：

- 功耗问题
- 可开发的指令集并行性很少
- 存储器访问速度提升缓慢

因而-> **多核**， 开发**线程级并行** 和 **数据集并行**



### 1.2 系统结构概念

按照**计算机语言**的角度->计算机系统按功能划分成 **多级层次结构**，每一层以一种语言为特征。

按照计算机系统的多级层次结构，不同级程序员看到的计算机具有不同的属性。

**广义的系统结构定义**：指令集结构、组成、硬件

- 传统机器语言级程序员看到的属性：
  - 指令系统、数据表示、寻址规则、寄存器定义、终端系统、工作转台的定义和切换、存储系统、信息保护、IO结构

计算机系统结构概念的**实质**：确定软、硬件的界面

**计算机组成、实现**：一种体系结构可以有多种组成，一种组成可以有多种物理实现。

计算机系统结构的**分类**：

- Flynn：**指令流**和**数据流**的多倍性进行分类

  指令流：计算机执行的指令序列。

  数据流：由指令条用的数据序列

  多倍性：在系统受限的部件下，同时处于同一执行阶段的指令和数据的最大数目。

  - SISD SIMD MISD MIMD

- 冯氏：系统最大并行度（m*n）



### 1.3 定量分析技术

4个定量原理：

1. 经常性时间为重点。

   对经常发生的情况采用优化方法的原则进行选择，得到更多总体上的改进。

   **优化**：分配更多资源、达到更高性能或者分配更多的电能？

2. Amdahl定律

   加快某部件的执行速度对于系统总体性能的提升，受限于该部件执行时间占总执行时间的百分比。

   概念：加速比、可改进比例 \< 1、部件加速比 \>1

   **一种性能改进的递减规则**

   **重要推论**：如果只针对整个任务的一部分进行改进和优化，那么所获得的加速比不超过
   $$

   $$

   $$
   \frac{1}{1-可改进比例}
   $$




3. CPU性能公式

   CPU时间 = IC * CPI * 时钟周期时间

   CPU时钟周期数 = $\sum (CPI_i \times IC_i)$

   **CPI = $\sum (CPI_i \times \frac{IC_i}{IC})$**

4. 程序的局部性原理

   程序执行时所访问的存储器地址分布不是随机

   的，而是相对地簇聚

   - 时间局部性
   - 空间局部性

性能评测：

1. 执行时间：

   - 全部时间
   - CPU时间：CPU执行所给定的程序所花费的时间，不包含I/O等待时间以及运行其他程序的时间。
     - 用户CPU时间
     - 系统CPU时间：用户程序运行期间操作系统耗费的CPU时间

   吞吐率：单位时间的任务量

2. 基准测试程序

   基准测试程序套件: SPEC系列

   事务处理性能测试基准程序（TP）



### 1.4 发展

冯诺依曼结构：

1. 存储程序原理的**基本点**：**指令驱动**
2. 主要特点：
   - 以运算器为中心
   - 在存储器中，指令和数据同等对待
   - 存储器是按地址访问、按顺序线性编址的一堆结构，每个单元的位数是固定的
   - 指令执行顺序
   - 指令=操作码+地址码
   - 二进制表示、运算
3. 改进
   - 输入输出方式：
     - 程序控制：等待、中断
     - DMA
     - IO处理机
   - 并行处理
   - 存储器
   - 指令集

软件的可移植性：

- 系列机

  **向后兼容**是系列机的**根本特征**。

- 模拟、仿真

- 统一高级语言

摩尔定律：集成电路芯片晶体管数 18个月翻番

**应用需求** 是 促使计算机系统结构发展的最根本的**动力**

计算机性能随时间下移



### 1.5 并行性

并行性：计算机系统在同一时刻或同一时间间隔内进行多种运算或操作。

- 同时性：时刻
- 并发行：时间间隔

处理数据的角度：字串位串->全并行（字并位并）

执行程序的角度：指令内部、指令级、现成绩、任务级、作业级

- 三种途径：

  - 时间重叠（主导作用）

    - 部件功能专用化->流水线

  - 资源重复

    - 多提存储器
    - 多操作部件->指令集并行

  - 资源共享

    单处理机模拟多处理机的功能（虚拟机）

    - 分时系统

3种多处理机：

- 异构型多处理机

  不用类型、至少担负不同功能的处理机组成，按照要求的顺序，**利用时间重叠原理**，多个任务进行加工，完成**各自功能**。

- 同构性多处理机

  同类型，至少担负同种功能的，同时处理统一作业中能并行的多个任务。

- 分布式系统日常的副本/第一章复习笔记的副本 3.md## 第一章

### 术语挑选

- **虚拟机**：用软件实现的机器。

- **翻译、解释**

- **计算机系统结构**：传统机器程序员所看到的计算机属性，即概念性结构与功能特性。

- **透明性**：在计算机技术中，把这种本来存在的事物或属性，但从某种角度看又好像不存在的概念称为透明性。

- **计算机组成**：计算机系统结构的逻辑实现，包含物理机器级中的数据流和控制流的组成以及逻辑设计等。着眼于物理机器级內**各事件的排序方式和控制方式、各部件的功能和部件之间的联系**

- **计算机实现**：计算机组成的物理实现。着眼于**器件**和**微组装技术**。

- **Amdahl定律**：当对一个系统中的某个部件进行改进后，所能获得的整个系统性能的提高，受限于该部件的执行时间占总执行时间的百分比。

- **系列机**：由同一厂家生产的具有相同系统结构、但具有不同组成和实现的一系列不同型号的计算机。

- **模拟**，**仿真**

- **并行性**：计算机系统在同一时刻或者同一时间间隔内进行多种运算或操作。只要在时间上相互重叠，就存在并行性。它包括同时性与并发性两种含义。

  - **时间重叠**：在并行性概念中引入<u>时间因素</u>，让多个处理过程在时间上相互错开，轮流重叠地使用同一套硬件设备的各个部分，以加快硬件周转而赢得速度。

    **资源重复**：在并行性概念中引入<u>空间因素</u>，以数量取胜。通过重复设置硬件资源，大幅度地提高计算机系统的性能。

    **资源共享**：这是一种软件方法，它使多个任务按一定时间顺序轮流使用同一套硬件设备。

- **异构型多处理机系统**：由多个不同类型、至少担负不同功能的处理机组成，它们按照作业要求的顺序，利用时间重叠原理，依次对它们的多个任务进行加工，各自完成规定的功能动作。

  **同构型多处理机系统**：由多个同类型或至少担负同等功能的处理机组成，它们同时处理同一作业中能并行执行的多个任务。



### 1.1

2002年后，计算机性能下降的原因：

- 功耗问题
- 可开发的指令集并行性很少
- 存储器访问速度提升缓慢

因而-> **多核**， 开发**线程级并行** 和 **数据集并行**



### 1.2 系统结构概念

按照**计算机语言**的角度->计算机系统按功能划分成 **多级层次结构**，每一层以一种语言为特征。

按照计算机系统的多级层次结构，不同级程序员看到的计算机具有不同的属性。

**广义的系统结构定义**：指令集结构、组成、硬件

- 传统机器语言级程序员看到的属性：
  - 指令系统、数据表示、寻址规则、寄存器定义、终端系统、工作转台的定义和切换、存储系统、信息保护、IO结构

计算机系统结构概念的**实质**：确定软、硬件的界面

**计算机组成、实现**：一种体系结构可以有多种组成，一种组成可以有多种物理实现。

计算机系统结构的**分类**：

- Flynn：**指令流**和**数据流**的多倍性进行分类

  指令流：计算机执行的指令序列。

  数据流：由指令条用的数据序列

  多倍性：在系统受限的部件下，同时处于同一执行阶段的指令和数据的最大数目。

  - SISD SIMD MISD MIMD

- 冯氏：系统最大并行度（m*n）



### 1.3 定量分析技术

4个定量原理：

1. 经常性时间为重点。

   对经常发生的情况采用优化方法的原则进行选择，得到更多总体上的改进。

   **优化**：分配更多资源、达到更高性能或者分配更多的电能？

2. Amdahl定律

   加快某部件的执行速度对于系统总体性能的提升，受限于该部件执行时间占总执行时间的百分比。

   概念：加速比、可改进比例 \< 1、部件加速比 \>1

   **一种性能改进的递减规则**

   **重要推论**：如果只针对整个任务的一部分进行改进和优化，那么所获得的加速比不超过
   $$

   $$

   $$
   \frac{1}{1-可改进比例}
   $$




3. CPU性能公式

   CPU时间 = IC * CPI * 时钟周期时间

   CPU时钟周期数 = $\sum (CPI_i \times IC_i)$

   **CPI = $\sum (CPI_i \times \frac{IC_i}{IC})$**

4. 程序的局部性原理

   程序执行时所访问的存储器地址分布不是随机

   的，而是相对地簇聚

   - 时间局部性
   - 空间局部性

性能评测：

1. 执行时间：

   - 全部时间
   - CPU时间：CPU执行所给定的程序所花费的时间，不包含I/O等待时间以及运行其他程序的时间。
     - 用户CPU时间
     - 系统CPU时间：用户程序运行期间操作系统耗费的CPU时间

   吞吐率：单位时间的任务量

2. 基准测试程序

   基准测试程序套件: SPEC系列

   事务处理性能测试基准程序（TP）



### 1.4 发展

冯诺依曼结构：

1. 存储程序原理的**基本点**：**指令驱动**
2. 主要特点：
   - 以运算器为中心
   - 在存储器中，指令和数据同等对待
   - 存储器是按地址访问、按顺序线性编址的一堆结构，每个单元的位数是固定的
   - 指令执行顺序
   - 指令=操作码+地址码
   - 二进制表示、运算
3. 改进
   - 输入输出方式：
     - 程序控制：等待、中断
     - DMA
     - IO处理机
   - 并行处理
   - 存储器
   - 指令集

软件的可移植性：

- 系列机

  **向后兼容**是系列机的**根本特征**。

- 模拟、仿真

- 统一高级语言

摩尔定律：集成电路芯片晶体管数 18个月翻番

**应用需求** 是 促使计算机系统结构发展的最根本的**动力**

计算机性能随时间下移



### 1.5 并行性

并行性：计算机系统在同一时刻或同一时间间隔内进行多种运算或操作。

- 同时性：时刻
- 并发行：时间间隔

处理数据的角度：字串位串->全并行（字并位并）

执行程序的角度：指令内部、指令级、现成绩、任务级、作业级

- 三种途径：

  - 时间重叠（主导作用）

    - 部件功能专用化->流水线

  - 资源重复

    - 多提存储器
    - 多操作部件->指令集并行

  - 资源共享

    单处理机模拟多处理机的功能（虚拟机）

    - 分时系统

3种多处理机：

- 异构型多处理机

  不用类型、至少担负不同功能的处理机组成，按照要求的顺序，**利用时间重叠原理**，多个任务进行加工，完成**各自功能**。

- 同构性多处理机

  同类型，至少担负同种功能的，同时处理统一作业中能并行的多个任务。

- 分布式系统日常的副本/第一章复习笔记的副本.md## 第一章

### 术语挑选

- **虚拟机**：用软件实现的机器。

- **翻译、解释**

- **计算机系统结构**：传统机器程序员所看到的计算机属性，即概念性结构与功能特性。

- **透明性**：在计算机技术中，把这种本来存在的事物或属性，但从某种角度看又好像不存在的概念称为透明性。

- **计算机组成**：计算机系统结构的逻辑实现，包含物理机器级中的数据流和控制流的组成以及逻辑设计等。着眼于物理机器级內**各事件的排序方式和控制方式、各部件的功能和部件之间的联系**

- **计算机实现**：计算机组成的物理实现。着眼于**器件**和**微组装技术**。

- **Amdahl定律**：当对一个系统中的某个部件进行改进后，所能获得的整个系统性能的提高，受限于该部件的执行时间占总执行时间的百分比。

- **系列机**：由同一厂家生产的具有相同系统结构、但具有不同组成和实现的一系列不同型号的计算机。

- **模拟**，**仿真**

- **并行性**：计算机系统在同一时刻或者同一时间间隔内进行多种运算或操作。只要在时间上相互重叠，就存在并行性。它包括同时性与并发性两种含义。

  - **时间重叠**：在并行性概念中引入<u>时间因素</u>，让多个处理过程在时间上相互错开，轮流重叠地使用同一套硬件设备的各个部分，以加快硬件周转而赢得速度。

    **资源重复**：在并行性概念中引入<u>空间因素</u>，以数量取胜。通过重复设置硬件资源，大幅度地提高计算机系统的性能。

    **资源共享**：这是一种软件方法，它使多个任务按一定时间顺序轮流使用同一套硬件设备。

- **异构型多处理机系统**：由多个不同类型、至少担负不同功能的处理机组成，它们按照作业要求的顺序，利用时间重叠原理，依次对它们的多个任务进行加工，各自完成规定的功能动作。

  **同构型多处理机系统**：由多个同类型或至少担负同等功能的处理机组成，它们同时处理同一作业中能并行执行的多个任务。



### 1.1

2002年后，计算机性能下降的原因：

- 功耗问题
- 可开发的指令集并行性很少
- 存储器访问速度提升缓慢

因而-> **多核**， 开发**线程级并行** 和 **数据集并行**



### 1.2 系统结构概念

按照**计算机语言**的角度->计算机系统按功能划分成 **多级层次结构**，每一层以一种语言为特征。

按照计算机系统的多级层次结构，不同级程序员看到的计算机具有不同的属性。

**广义的系统结构定义**：指令集结构、组成、硬件

- 传统机器语言级程序员看到的属性：
  - 指令系统、数据表示、寻址规则、寄存器定义、终端系统、工作转台的定义和切换、存储系统、信息保护、IO结构

计算机系统结构概念的**实质**：确定软、硬件的界面

**计算机组成、实现**：一种体系结构可以有多种组成，一种组成可以有多种物理实现。

计算机系统结构的**分类**：

- Flynn：**指令流**和**数据流**的多倍性进行分类

  指令流：计算机执行的指令序列。

  数据流：由指令条用的数据序列

  多倍性：在系统受限的部件下，同时处于同一执行阶段的指令和数据的最大数目。

  - SISD SIMD MISD MIMD

- 冯氏：系统最大并行度（m*n）



### 1.3 定量分析技术

4个定量原理：

1. 经常性时间为重点。

   对经常发生的情况采用优化方法的原则进行选择，得到更多总体上的改进。

   **优化**：分配更多资源、达到更高性能或者分配更多的电能？

2. Amdahl定律

   加快某部件的执行速度对于系统总体性能的提升，受限于该部件执行时间占总执行时间的百分比。

   概念：加速比、可改进比例 \< 1、部件加速比 \>1

   **一种性能改进的递减规则**

   **重要推论**：如果只针对整个任务的一部分进行改进和优化，那么所获得的加速比不超过
   $$

   $$

   $$
   \frac{1}{1-可改进比例}
   $$




3. CPU性能公式

   CPU时间 = IC * CPI * 时钟周期时间

   CPU时钟周期数 = $\sum (CPI_i \times IC_i)$

   **CPI = $\sum (CPI_i \times \frac{IC_i}{IC})$**

4. 程序的局部性原理

   程序执行时所访问的存储器地址分布不是随机

   的，而是相对地簇聚

   - 时间局部性
   - 空间局部性

性能评测：

1. 执行时间：

   - 全部时间
   - CPU时间：CPU执行所给定的程序所花费的时间，不包含I/O等待时间以及运行其他程序的时间。
     - 用户CPU时间
     - 系统CPU时间：用户程序运行期间操作系统耗费的CPU时间

   吞吐率：单位时间的任务量

2. 基准测试程序

   基准测试程序套件: SPEC系列

   事务处理性能测试基准程序（TP）



### 1.4 发展

冯诺依曼结构：

1. 存储程序原理的**基本点**：**指令驱动**
2. 主要特点：
   - 以运算器为中心
   - 在存储器中，指令和数据同等对待
   - 存储器是按地址访问、按顺序线性编址的一堆结构，每个单元的位数是固定的
   - 指令执行顺序
   - 指令=操作码+地址码
   - 二进制表示、运算
3. 改进
   - 输入输出方式：
     - 程序控制：等待、中断
     - DMA
     - IO处理机
   - 并行处理
   - 存储器
   - 指令集

软件的可移植性：

- 系列机

  **向后兼容**是系列机的**根本特征**。

- 模拟、仿真

- 统一高级语言

摩尔定律：集成电路芯片晶体管数 18个月翻番

**应用需求** 是 促使计算机系统结构发展的最根本的**动力**

计算机性能随时间下移



### 1.5 并行性

并行性：计算机系统在同一时刻或同一时间间隔内进行多种运算或操作。

- 同时性：时刻
- 并发行：时间间隔

处理数据的角度：字串位串->全并行（字并位并）

执行程序的角度：指令内部、指令级、现成绩、任务级、作业级

- 三种途径：

  - 时间重叠（主导作用）

    - 部件功能专用化->流水线

  - 资源重复

    - 多提存储器
    - 多操作部件->指令集并行

  - 资源共享

    单处理机模拟多处理机的功能（虚拟机）

    - 分时系统

3种多处理机：

- 异构型多处理机

  不用类型、至少担负不同功能的处理机组成，按照要求的顺序，**利用时间重叠原理**，多个任务进行加工，完成**各自功能**。

- 同构性多处理机

  同类型，至少担负同种功能的，同时处理统一作业中能并行的多个任务。

- 分布式系统日常的副本/第三章复习笔记.md## 第三章

### 名词解释

- **流水线**：将一个重复的时序过程，分解成为若干个子过程，而每一个子过程都可有效地在其专用功能段上与其它子过程同时执行

- **数据相关**：考虑两条指令i和j，*i*在*j*的前面，如果下述条件之一成立，则称指令*j*与指令i数据相关： 

  （1）指令*j*使用指令*i*产生的结果；

  （2）指令*j*与指令*k*数据相关，而指令*k*又与指令*i*数据相关。

- **名相关**：如果两条指令使用了相同的名，但是它们之间并没有数据流动，则称这两条指令存在名相关。

- **反相关**：考虑两条指令*i*和*j*，*i*在*j*的前面，如果指令*j*所写的名与指令*i*所读的名相同，则称指令*i*和*j*发生了反相关。

- **输出相关**：考虑两条指令*i*和*j*，*i*在*j*的前面，如果指令*j*和指令*i*所写的名相同，则称指令*i*和*j*发生了输出相关。

- **结构冲突**：因硬件资源满足不了指令重叠执行的要求而发生的冲突。

- **数据冲突**：当指令在流水线中重叠执行时，因需要用到前面指令的执行结果而发生的冲突。

- **控制冲突**：流水线遇到分支指令或其它会改变PC值的指令所引起的冲突。

- **定向**：用来解决写后读冲突的。

- **写后读冲突**

  **写后写冲突**、**读后写冲突** （经典5段不会出现的）

- **链接技术**：具有先写后读相关的两条指令，在不出现功能部件冲突和Vi冲突的情况下，可以把功能部件链接起来进行流水处理，以达到加快执行的目的。

- **分段开采**：当向量的长度大于向量寄存器的长度时，必须把长向量分成长度固定的段，然后循环分段处理，每一次循环只处理一个向量段。

### 3.1 流水线基本概念

- 流水线技术

  - 流水线的**级**或**段**
  - 流水线的**深度**

- 流水线特点

  - 分解为多个子过程，专门的功能部件

  - 各段时间相等

    时间长的段成为流水线的**瓶颈**

  - 功能部件后面又一个缓冲寄存器（锁存器）-> **流水寄存器**

    **作用**：相邻两段之间<u>传送数据</u>，保证提供后面要用到的数据，各段的处理工作<u>相互隔离</u>

  - 大量的时序过程，才能发挥效率

  - **通过时间**和**排空时间**

    第一个和最后一个，从进入到流出所需要的时间

- 分类

  - 单功能、多功能（ASC）

  - 静态流水线、动态流水线

  - 部件级流水线（运算操作流水线）

    处理机级流水线（指令流水线）

    处理机间流水线（宏流水线）

  - 线性流水线、非线性流水线

    - 非线性 调度问题，争用流水段

  - 顺序流水线、乱序流水线（无序、错序、异步）

  - 标量处理机、向量处理机

### 3.2 性能指标

- **吞吐率TP** 

  单位时间完成的任务数量或输出结果的数量

  - 实际，最大

  解决**流水线瓶颈**的方法

  - **细分瓶颈段**
  - **重复设置瓶颈段**

- **加速比S**

  不使用流水线和使用流水线所用的时间比

  最大加速比 = k

  流水线的段数并非越多越好。

- **效率E**

  流水线中设备实际使用时间与整个运行时间的比值。（数面积）

问题：

- 瓶颈问题

- 额外开销

  - 流水寄存器延迟

    建立时间：信号到达前，寄存器保持稳定的时间

    传输延迟：信号到达后，寄存器输出可用的时间

  - 时钟偏移开销

    时钟到达各流水寄存器的最大差值时间

  时钟周期小到与额外开销相同时，流水已没有意义。

- 冲突问题—最重要的问题之一

### 3.3 相关与冲突

5段RICS：IF -> ID -> EX -> MEM -> WB

- **相关**

  两条指令之间在某种依赖关系

  - 数据相关

  - 名相关 （i写j读）

    相同的名，但没有数据流动

    - 反相关 （i读j写）
    - 输出相关（i写j写）

  - 控制相关

- **流水线冲突**

  - **结构冲突**

    原因：

    - 功能部件不是完全流水的
    - 资源份数不够

    访存冲突：

    1. 插入暂停周期（流水线气泡）

    2. 设置独立的指令、数据存储器

       或者独立的指令、数据Cache

    语序结构冲突的存在：成本

  - **数据冲突**

    靠太近

    - RAW 写后读

    - WAW 写后写

      只发生在：

      - 流水线不止一个段可以写
      - 当前停顿，后续可以前进

      5段里面不存在的

    - WAR 读后写

      只发生在：

      - 有的写提前、有的读滞后
      - 重新排序

      依然不存在的

    **定向技术**

    - 将计算结果从其**产生的地方**直接送到其他指令**需要它的地方**，那么就可以避免停顿

    - 然而，定向并不能解决所有问题，比如：LD->DADD

      增加**互锁硬件**，插入暂停

      作用：检测发现数据冲突，使流水线停顿

    **指令调度**／**流水线调度**

    让编译器重新组织顺序

  - **控制冲突**

    简单方法：冻结、排空（3个周期的延迟）

    **分支延迟**：由分支指令引起的

    假设：**判断转移成功**和**确定目标地址**都在**ID**段完成->分支延迟为一个周期

    3种编译器减少延迟的方法：（静态）

    - **预测分支失败**

      - 确定失败，不跳转，一切正常

      - 确定成功，跳转，之前的指令转化为空操作

        保重能够退回原先的状态

    - **预测分支成功**

      - 前提：先知道跳转的目标地址

        对5段流水线没有任何好处

    - **延迟分支**

      延迟分支指令的执行时间，加上**延迟槽**

      - 从前调度
      - 从目标出调度
      - 从失败处调度

      **分支取消机制**

### 3.4 实现--MIPS

- 流水寄存器

- 所有的数据冲突可以在ID段检测到，流出ID前暂停->互锁

  load互锁

  检测到RAW冲突，IF、ID段的指令不再前进：

  - ID/EX.IR中的操作吗改为0
  - IF/ID寄存器的内容回送到自己的入口

- ID段增设加法器

- 条件测试移到ID段

- 结果送回IF段的MUX1

  ​日常的副本/第三章复习笔记的副本 2.md## 第三章

### 名词解释

- **流水线**：将一个重复的时序过程，分解成为若干个子过程，而每一个子过程都可有效地在其专用功能段上与其它子过程同时执行

- **数据相关**：考虑两条指令i和j，*i*在*j*的前面，如果下述条件之一成立，则称指令*j*与指令i数据相关： 

  （1）指令*j*使用指令*i*产生的结果；

  （2）指令*j*与指令*k*数据相关，而指令*k*又与指令*i*数据相关。

- **名相关**：如果两条指令使用了相同的名，但是它们之间并没有数据流动，则称这两条指令存在名相关。

- **反相关**：考虑两条指令*i*和*j*，*i*在*j*的前面，如果指令*j*所写的名与指令*i*所读的名相同，则称指令*i*和*j*发生了反相关。

- **输出相关**：考虑两条指令*i*和*j*，*i*在*j*的前面，如果指令*j*和指令*i*所写的名相同，则称指令*i*和*j*发生了输出相关。

- **结构冲突**：因硬件资源满足不了指令重叠执行的要求而发生的冲突。

- **数据冲突**：当指令在流水线中重叠执行时，因需要用到前面指令的执行结果而发生的冲突。

- **控制冲突**：流水线遇到分支指令或其它会改变PC值的指令所引起的冲突。

- **定向**：用来解决写后读冲突的。

- **写后读冲突**

  **写后写冲突**、**读后写冲突** （经典5段不会出现的）

- **链接技术**：具有先写后读相关的两条指令，在不出现功能部件冲突和Vi冲突的情况下，可以把功能部件链接起来进行流水处理，以达到加快执行的目的。

- **分段开采**：当向量的长度大于向量寄存器的长度时，必须把长向量分成长度固定的段，然后循环分段处理，每一次循环只处理一个向量段。

### 3.1 流水线基本概念

- 流水线技术

  - 流水线的**级**或**段**
  - 流水线的**深度**

- 流水线特点

  - 分解为多个子过程，专门的功能部件

  - 各段时间相等

    时间长的段成为流水线的**瓶颈**

  - 功能部件后面又一个缓冲寄存器（锁存器）-> **流水寄存器**

    **作用**：相邻两段之间<u>传送数据</u>，保证提供后面要用到的数据，各段的处理工作<u>相互隔离</u>

  - 大量的时序过程，才能发挥效率

  - **通过时间**和**排空时间**

    第一个和最后一个，从进入到流出所需要的时间

- 分类

  - 单功能、多功能（ASC）

  - 静态流水线、动态流水线

  - 部件级流水线（运算操作流水线）

    处理机级流水线（指令流水线）

    处理机间流水线（宏流水线）

  - 线性流水线、非线性流水线

    - 非线性 调度问题，争用流水段

  - 顺序流水线、乱序流水线（无序、错序、异步）

  - 标量处理机、向量处理机

### 3.2 性能指标

- **吞吐率TP** 

  单位时间完成的任务数量或输出结果的数量

  - 实际，最大

  解决**流水线瓶颈**的方法

  - **细分瓶颈段**
  - **重复设置瓶颈段**

- **加速比S**

  不使用流水线和使用流水线所用的时间比

  最大加速比 = k

  流水线的段数并非越多越好。

- **效率E**

  流水线中设备实际使用时间与整个运行时间的比值。（数面积）

问题：

- 瓶颈问题

- 额外开销

  - 流水寄存器延迟

    建立时间：信号到达前，寄存器保持稳定的时间

    传输延迟：信号到达后，寄存器输出可用的时间

  - 时钟偏移开销

    时钟到达各流水寄存器的最大差值时间

  时钟周期小到与额外开销相同时，流水已没有意义。

- 冲突问题—最重要的问题之一

### 3.3 相关与冲突

5段RICS：IF -> ID -> EX -> MEM -> WB

- **相关**

  两条指令之间在某种依赖关系

  - 数据相关

  - 名相关 （i写j读）

    相同的名，但没有数据流动

    - 反相关 （i读j写）
    - 输出相关（i写j写）

  - 控制相关

- **流水线冲突**

  - **结构冲突**

    原因：

    - 功能部件不是完全流水的
    - 资源份数不够

    访存冲突：

    1. 插入暂停周期（流水线气泡）

    2. 设置独立的指令、数据存储器

       或者独立的指令、数据Cache

    语序结构冲突的存在：成本

  - **数据冲突**

    靠太近

    - RAW 写后读

    - WAW 写后写

      只发生在：

      - 流水线不止一个段可以写
      - 当前停顿，后续可以前进

      5段里面不存在的

    - WAR 读后写

      只发生在：

      - 有的写提前、有的读滞后
      - 重新排序

      依然不存在的

    **定向技术**

    - 将计算结果从其**产生的地方**直接送到其他指令**需要它的地方**，那么就可以避免停顿

    - 然而，定向并不能解决所有问题，比如：LD->DADD

      增加**互锁硬件**，插入暂停

      作用：检测发现数据冲突，使流水线停顿

    **指令调度**／**流水线调度**

    让编译器重新组织顺序

  - **控制冲突**

    简单方法：冻结、排空（3个周期的延迟）

    **分支延迟**：由分支指令引起的

    假设：**判断转移成功**和**确定目标地址**都在**ID**段完成->分支延迟为一个周期

    3种编译器减少延迟的方法：（静态）

    - **预测分支失败**

      - 确定失败，不跳转，一切正常

      - 确定成功，跳转，之前的指令转化为空操作

        保重能够退回原先的状态

    - **预测分支成功**

      - 前提：先知道跳转的目标地址

        对5段流水线没有任何好处

    - **延迟分支**

      延迟分支指令的执行时间，加上**延迟槽**

      - 从前调度
      - 从目标出调度
      - 从失败处调度

      **分支取消机制**

### 3.4 实现--MIPS

- 流水寄存器

- 所有的数据冲突可以在ID段检测到，流出ID前暂停->互锁

  load互锁

  检测到RAW冲突，IF、ID段的指令不再前进：

  - ID/EX.IR中的操作吗改为0
  - IF/ID寄存器的内容回送到自己的入口

- ID段增设加法器

- 条件测试移到ID段

- 结果送回IF段的MUX1

  ​日常的副本/第三章复习笔记的副本 3.md## 第三章

### 名词解释

- **流水线**：将一个重复的时序过程，分解成为若干个子过程，而每一个子过程都可有效地在其专用功能段上与其它子过程同时执行

- **数据相关**：考虑两条指令i和j，*i*在*j*的前面，如果下述条件之一成立，则称指令*j*与指令i数据相关： 

  （1）指令*j*使用指令*i*产生的结果；

  （2）指令*j*与指令*k*数据相关，而指令*k*又与指令*i*数据相关。

- **名相关**：如果两条指令使用了相同的名，但是它们之间并没有数据流动，则称这两条指令存在名相关。

- **反相关**：考虑两条指令*i*和*j*，*i*在*j*的前面，如果指令*j*所写的名与指令*i*所读的名相同，则称指令*i*和*j*发生了反相关。

- **输出相关**：考虑两条指令*i*和*j*，*i*在*j*的前面，如果指令*j*和指令*i*所写的名相同，则称指令*i*和*j*发生了输出相关。

- **结构冲突**：因硬件资源满足不了指令重叠执行的要求而发生的冲突。

- **数据冲突**：当指令在流水线中重叠执行时，因需要用到前面指令的执行结果而发生的冲突。

- **控制冲突**：流水线遇到分支指令或其它会改变PC值的指令所引起的冲突。

- **定向**：用来解决写后读冲突的。

- **写后读冲突**

  **写后写冲突**、**读后写冲突** （经典5段不会出现的）

- **链接技术**：具有先写后读相关的两条指令，在不出现功能部件冲突和Vi冲突的情况下，可以把功能部件链接起来进行流水处理，以达到加快执行的目的。

- **分段开采**：当向量的长度大于向量寄存器的长度时，必须把长向量分成长度固定的段，然后循环分段处理，每一次循环只处理一个向量段。

### 3.1 流水线基本概念

- 流水线技术

  - 流水线的**级**或**段**
  - 流水线的**深度**

- 流水线特点

  - 分解为多个子过程，专门的功能部件

  - 各段时间相等

    时间长的段成为流水线的**瓶颈**

  - 功能部件后面又一个缓冲寄存器（锁存器）-> **流水寄存器**

    **作用**：相邻两段之间<u>传送数据</u>，保证提供后面要用到的数据，各段的处理工作<u>相互隔离</u>

  - 大量的时序过程，才能发挥效率

  - **通过时间**和**排空时间**

    第一个和最后一个，从进入到流出所需要的时间

- 分类

  - 单功能、多功能（ASC）

  - 静态流水线、动态流水线

  - 部件级流水线（运算操作流水线）

    处理机级流水线（指令流水线）

    处理机间流水线（宏流水线）

  - 线性流水线、非线性流水线

    - 非线性 调度问题，争用流水段

  - 顺序流水线、乱序流水线（无序、错序、异步）

  - 标量处理机、向量处理机

### 3.2 性能指标

- **吞吐率TP** 

  单位时间完成的任务数量或输出结果的数量

  - 实际，最大

  解决**流水线瓶颈**的方法

  - **细分瓶颈段**
  - **重复设置瓶颈段**

- **加速比S**

  不使用流水线和使用流水线所用的时间比

  最大加速比 = k

  流水线的段数并非越多越好。

- **效率E**

  流水线中设备实际使用时间与整个运行时间的比值。（数面积）

问题：

- 瓶颈问题

- 额外开销

  - 流水寄存器延迟

    建立时间：信号到达前，寄存器保持稳定的时间

    传输延迟：信号到达后，寄存器输出可用的时间

  - 时钟偏移开销

    时钟到达各流水寄存器的最大差值时间

  时钟周期小到与额外开销相同时，流水已没有意义。

- 冲突问题—最重要的问题之一

### 3.3 相关与冲突

5段RICS：IF -> ID -> EX -> MEM -> WB

- **相关**

  两条指令之间在某种依赖关系

  - 数据相关

  - 名相关 （i写j读）

    相同的名，但没有数据流动

    - 反相关 （i读j写）
    - 输出相关（i写j写）

  - 控制相关

- **流水线冲突**

  - **结构冲突**

    原因：

    - 功能部件不是完全流水的
    - 资源份数不够

    访存冲突：

    1. 插入暂停周期（流水线气泡）

    2. 设置独立的指令、数据存储器

       或者独立的指令、数据Cache

    语序结构冲突的存在：成本

  - **数据冲突**

    靠太近

    - RAW 写后读

    - WAW 写后写

      只发生在：

      - 流水线不止一个段可以写
      - 当前停顿，后续可以前进

      5段里面不存在的

    - WAR 读后写

      只发生在：

      - 有的写提前、有的读滞后
      - 重新排序

      依然不存在的

    **定向技术**

    - 将计算结果从其**产生的地方**直接送到其他指令**需要它的地方**，那么就可以避免停顿

    - 然而，定向并不能解决所有问题，比如：LD->DADD

      增加**互锁硬件**，插入暂停

      作用：检测发现数据冲突，使流水线停顿

    **指令调度**／**流水线调度**

    让编译器重新组织顺序

  - **控制冲突**

    简单方法：冻结、排空（3个周期的延迟）

    **分支延迟**：由分支指令引起的

    假设：**判断转移成功**和**确定目标地址**都在**ID**段完成->分支延迟为一个周期

    3种编译器减少延迟的方法：（静态）

    - **预测分支失败**

      - 确定失败，不跳转，一切正常

      - 确定成功，跳转，之前的指令转化为空操作

        保重能够退回原先的状态

    - **预测分支成功**

      - 前提：先知道跳转的目标地址

        对5段流水线没有任何好处

    - **延迟分支**

      延迟分支指令的执行时间，加上**延迟槽**

      - 从前调度
      - 从目标出调度
      - 从失败处调度

      **分支取消机制**

### 3.4 实现--MIPS

- 流水寄存器

- 所有的数据冲突可以在ID段检测到，流出ID前暂停->互锁

  load互锁

  检测到RAW冲突，IF、ID段的指令不再前进：

  - ID/EX.IR中的操作吗改为0
  - IF/ID寄存器的内容回送到自己的入口

- ID段增设加法器

- 条件测试移到ID段

- 结果送回IF段的MUX1

  ​日常的副本/第三章复习笔记的副本.md## 第三章

### 名词解释

- **流水线**：将一个重复的时序过程，分解成为若干个子过程，而每一个子过程都可有效地在其专用功能段上与其它子过程同时执行

- **数据相关**：考虑两条指令i和j，*i*在*j*的前面，如果下述条件之一成立，则称指令*j*与指令i数据相关： 

  （1）指令*j*使用指令*i*产生的结果；

  （2）指令*j*与指令*k*数据相关，而指令*k*又与指令*i*数据相关。

- **名相关**：如果两条指令使用了相同的名，但是它们之间并没有数据流动，则称这两条指令存在名相关。

- **反相关**：考虑两条指令*i*和*j*，*i*在*j*的前面，如果指令*j*所写的名与指令*i*所读的名相同，则称指令*i*和*j*发生了反相关。

- **输出相关**：考虑两条指令*i*和*j*，*i*在*j*的前面，如果指令*j*和指令*i*所写的名相同，则称指令*i*和*j*发生了输出相关。

- **结构冲突**：因硬件资源满足不了指令重叠执行的要求而发生的冲突。

- **数据冲突**：当指令在流水线中重叠执行时，因需要用到前面指令的执行结果而发生的冲突。

- **控制冲突**：流水线遇到分支指令或其它会改变PC值的指令所引起的冲突。

- **定向**：用来解决写后读冲突的。

- **写后读冲突**

  **写后写冲突**、**读后写冲突** （经典5段不会出现的）

- **链接技术**：具有先写后读相关的两条指令，在不出现功能部件冲突和Vi冲突的情况下，可以把功能部件链接起来进行流水处理，以达到加快执行的目的。

- **分段开采**：当向量的长度大于向量寄存器的长度时，必须把长向量分成长度固定的段，然后循环分段处理，每一次循环只处理一个向量段。

### 3.1 流水线基本概念

- 流水线技术

  - 流水线的**级**或**段**
  - 流水线的**深度**

- 流水线特点

  - 分解为多个子过程，专门的功能部件

  - 各段时间相等

    时间长的段成为流水线的**瓶颈**

  - 功能部件后面又一个缓冲寄存器（锁存器）-> **流水寄存器**

    **作用**：相邻两段之间<u>传送数据</u>，保证提供后面要用到的数据，各段的处理工作<u>相互隔离</u>

  - 大量的时序过程，才能发挥效率

  - **通过时间**和**排空时间**

    第一个和最后一个，从进入到流出所需要的时间

- 分类

  - 单功能、多功能（ASC）

  - 静态流水线、动态流水线

  - 部件级流水线（运算操作流水线）

    处理机级流水线（指令流水线）

    处理机间流水线（宏流水线）

  - 线性流水线、非线性流水线

    - 非线性 调度问题，争用流水段

  - 顺序流水线、乱序流水线（无序、错序、异步）

  - 标量处理机、向量处理机

### 3.2 性能指标

- **吞吐率TP** 

  单位时间完成的任务数量或输出结果的数量

  - 实际，最大

  解决**流水线瓶颈**的方法

  - **细分瓶颈段**
  - **重复设置瓶颈段**

- **加速比S**

  不使用流水线和使用流水线所用的时间比

  最大加速比 = k

  流水线的段数并非越多越好。

- **效率E**

  流水线中设备实际使用时间与整个运行时间的比值。（数面积）

问题：

- 瓶颈问题

- 额外开销

  - 流水寄存器延迟

    建立时间：信号到达前，寄存器保持稳定的时间

    传输延迟：信号到达后，寄存器输出可用的时间

  - 时钟偏移开销

    时钟到达各流水寄存器的最大差值时间

  时钟周期小到与额外开销相同时，流水已没有意义。

- 冲突问题—最重要的问题之一

### 3.3 相关与冲突

5段RICS：IF -> ID -> EX -> MEM -> WB

- **相关**

  两条指令之间在某种依赖关系

  - 数据相关

  - 名相关 （i写j读）

    相同的名，但没有数据流动

    - 反相关 （i读j写）
    - 输出相关（i写j写）

  - 控制相关

- **流水线冲突**

  - **结构冲突**

    原因：

    - 功能部件不是完全流水的
    - 资源份数不够

    访存冲突：

    1. 插入暂停周期（流水线气泡）

    2. 设置独立的指令、数据存储器

       或者独立的指令、数据Cache

    语序结构冲突的存在：成本

  - **数据冲突**

    靠太近

    - RAW 写后读

    - WAW 写后写

      只发生在：

      - 流水线不止一个段可以写
      - 当前停顿，后续可以前进

      5段里面不存在的

    - WAR 读后写

      只发生在：

      - 有的写提前、有的读滞后
      - 重新排序

      依然不存在的

    **定向技术**

    - 将计算结果从其**产生的地方**直接送到其他指令**需要它的地方**，那么就可以避免停顿

    - 然而，定向并不能解决所有问题，比如：LD->DADD

      增加**互锁硬件**，插入暂停

      作用：检测发现数据冲突，使流水线停顿

    **指令调度**／**流水线调度**

    让编译器重新组织顺序

  - **控制冲突**

    简单方法：冻结、排空（3个周期的延迟）

    **分支延迟**：由分支指令引起的

    假设：**判断转移成功**和**确定目标地址**都在**ID**段完成->分支延迟为一个周期

    3种编译器减少延迟的方法：（静态）

    - **预测分支失败**

      - 确定失败，不跳转，一切正常

      - 确定成功，跳转，之前的指令转化为空操作

        保重能够退回原先的状态

    - **预测分支成功**

      - 前提：先知道跳转的目标地址

        对5段流水线没有任何好处

    - **延迟分支**

      延迟分支指令的执行时间，加上**延迟槽**

      - 从前调度
      - 从目标出调度
      - 从失败处调度

      **分支取消机制**

### 3.4 实现--MIPS

- 流水寄存器

- 所有的数据冲突可以在ID段检测到，流出ID前暂停->互锁

  load互锁

  检测到RAW冲突，IF、ID段的指令不再前进：

  - ID/EX.IR中的操作吗改为0
  - IF/ID寄存器的内容回送到自己的入口

- ID段增设加法器

- 条件测试移到ID段

- 结果送回IF段的MUX1

  ​日常的副本/第二章复习笔记.md## 第二章

### 2.1

存储操作数的操作单元：堆栈、累加器、通用寄存器组

通用寄存器分为：RM结构、RR结构、MM结构（很少用）（R— 寄存器、M存储器）

通用寄存器优势（灵活性、提高性能方面）：

- 寄存器的访问速度比存储器快
- 对编译器而言，能更加容易、有效地分配和使用寄存器
- 寄存器可以用来存放变量

根据ALU指令的操作数个数，对通用寄存器型指令集进行进一步细分：

- ALU指令的操作数个数
- ALU指令的存储器操作数个数
- 具体表 28页表2.2

| 指令集结构类型 | 优点                                       | 缺点                         |
| ------- | ---------------------------------------- | -------------------------- |
| RR      | 指令字长固定，指令结构简洁，执行时钟周期数相近                  | 指令条数多，目标代码不够紧凑，程序占用空间大     |
| RM      | 可以在ALU指令中直接对存储器操作数进行引用，容易对指令进行编码，目标代码比较紧凑 | 两个操作数不对称，限制寄存器个数，执行时钟周期差别大 |
| MM      | 目标代码紧凑，不需要寄存器保存变量                        | 指令字长变化大，每条指令工作差别大，存储器频繁访问  |

### 2.2

寻址方式：一种指令集结构如何确定所有访问的数据的地址

有效地址：由寻址方式确定的实际存储器地址

表2.4 操作数寻址方式

多种寻址方式：减少程序的指令条数 增加复杂度、CPI

立即数寻址方式、偏移寻址方式频度最高 一些性质31-32页

### 2.3

确定功能由什么实现，考虑的因素：速度、成本、灵活性

- 硬件：速度快、成本高、灵活性低
- 软件：速度低、成本低、灵活性高

指令集基本要求：

- 完整性
  - 有限可用的存储空间内，对于任何可解问题编程，指令集提供的指令足够使用
  - 功能齐全、使用方便
- 规整性
  - 对称性：所有与指令集相关的存储单元使用、操作码设置都是对称的
  - 均匀性：对各种不同的操作数类型、字长、操作种类和数据存储单元，指令设置要同等对待
- 高效率
  - 指令的执行速度快、使用频率高
- 兼容性


CISC指令集：

- 追求目标：强化指令功能、减少指令条数，以达到提高性能的目的
- 增强指令功能从以下几个方面：
  - 面向目标程序增强指令功能
    - 面向目标程序优化指令集释提高计算机性能的最直接的方法
    - 增强运算型指令功能
    - 增强数据传送指令的功能
    - 增强程序控制指令的功能
  - 面向高级语言的优化实现来改进指令集
    - 高级语言与一般的机器语言的语义差距非常大。一方面：编译器本身比较复杂；二方面：编译生成的目标代码比较难以达到好的优化
    - 增强对高级语言和编译器的支持（35页）
    - 使用高级语言计算机（36页）
    - 面向操作系统的优化实现改进指令集（36-37页）

CISC指令集存在的问题：

- 各种指令的使用频度相差悬殊，许多指令很少用到
- 指令集庞大，指令条数很多，许多指令的功能又很复杂
- 许多指令操作繁杂，CPI值比较大，执行速度慢；有可能使整个程序的执行时间反而增加
- 指令功能复杂，规整性不好，不利于采用流水技术来提高性能

RISC计算机设计遵循原则：

- 指令条数少而简单，只选取使用频度很高的指令
- 采用简单而统一的指令格式，减少寻址方式。字长32位or64位
- 指令的执行在单个机器周期内完成（流水线后）
- load和store才能访问存储器，采用load-store结构
- 大多数指令都采用硬连逻辑来实现
- 强调优化编译器的作用，为高级程序语言生成优化的代码
- 充分利用流水技术

早起RISC微处理器特点：

- load-store结构
- 字长为32位
- 高效的流水技术

控制指令

- 分类
  - 跳转：无条件改变控制流指令
  - 分支：有条件改变控制流指令
- 改变控制流的指令：条件分支、跳转、过程调用、过程返回（分支占大半部分）

3种表示分支条件的主要方法

| 名称      | 方法                           | 优点            | 缺点                                |
| ------- | ---------------------------- | ------------- | --------------------------------- |
| 条件码（CC） | 检测由ALU操作设置的一些特殊位(CC)         | 自由设置分支条件      | 条件码是增设的状态；限制了指令的执行顺序（确保条件码能够顺利传送） |
| 条件寄存器   | 比较指令把比较结果放入一个寄存器，需要的时候检测该寄存器 | 简单            | 占用了一个寄存器                          |
| 比较与分支   | 比较操作作为分支指令的一部分，通常这种比较是受限制的   | 一条指令（非两条）实现分支 | 流水方式时，该指令的操作太多，无法在一拍内做完           |

转移地址的表示（显式）

- 最常用的方法：指令中提供一个偏移量，偏移量加程序计数器(PC) — — PC相对寻址
  - 优点
    - 有效减少表示该目标地址所需的位数(一般目标地址离当前指令很近)
    - 位置无关(代码可以被转载到主存的任意位置)
  - 4～8位偏移量字段足够表示大多数转移目标地址

过程调用和返回

- 除了改变控制流，还要保存机器状态、返回地址(专门的链接寄存器、堆栈)
- 过去：专门的保存机制
- 现在：编译器生成load和store指令来保存或恢复寄存器

### 2.4

数据表示：计算机硬件能够直接识别、指令集可以直接调用的数据类型

数据结构：软件进行处理和实现的各种数据类型

如何确定数据表示：系统结构设计者要解决的问题（软硬件取舍折中）

表示操作数类型的方法

- 指令中操作码指定操作数的类型 常用
- 带标志符的数据表示 少见
- 41页

操作数大小

- 字节 8位；半字 16位；字 32位；双字 64 位
- 字符 ASCII码 一个字节
- 整数 二进制补码 字节、半字、字
- 浮点操作数 单精度浮点数 1个字；双精度浮点数 双字
- 十进制操作数类型 41页

访问频度 单字、双字的高

### 2.5

指令组成：操作码、地址码

指令格式的设计：确定指令字的编码方式，操作码和地址码的编码和表示方式

操作码：

- Huffman码，变长，不规整，不利于硬件处理
- 固定长度操作码，保证译码速度

寻址方式：

- 编码于操作码中，操作码描述寻址方式。load-store结构，寻址方式少
- 专门的地址描述符。多种寻址方式，指令操作数多

考虑因素：

- 寄存器个数、寻址方式的数目对指令平均字长的影响、目标代码大小的影响
- 指令易于硬件处理，特别是流水实现
- 指令字长是字节(8位)的整数倍

编码格式

- 变长编码格式
  - 寻址方式和操作种类很多时候，最好
  - 最少的二进制位来表示目标代码
  - 可能使各条指令的字长和执行时间差异很大
- 固定长度编码格式
  - 操作类型、寻址方式一起编码到操作码当中
  - 寻址方式和操作类型很少时，最好
  - 降低译码的复杂度，提高译码速度
  - RISC指令集采用该编码格式
- 混合型编码格式
  - 提供若干种固定的指令字长
  - 减少目标代码长度、降低译码复杂度日常的副本/第二章复习笔记的副本 2.md## 第二章

### 2.1

存储操作数的操作单元：堆栈、累加器、通用寄存器组

通用寄存器分为：RM结构、RR结构、MM结构（很少用）（R— 寄存器、M存储器）

通用寄存器优势（灵活性、提高性能方面）：

- 寄存器的访问速度比存储器快
- 对编译器而言，能更加容易、有效地分配和使用寄存器
- 寄存器可以用来存放变量

根据ALU指令的操作数个数，对通用寄存器型指令集进行进一步细分：

- ALU指令的操作数个数
- ALU指令的存储器操作数个数
- 具体表 28页表2.2

| 指令集结构类型 | 优点                                       | 缺点                         |
| ------- | ---------------------------------------- | -------------------------- |
| RR      | 指令字长固定，指令结构简洁，执行时钟周期数相近                  | 指令条数多，目标代码不够紧凑，程序占用空间大     |
| RM      | 可以在ALU指令中直接对存储器操作数进行引用，容易对指令进行编码，目标代码比较紧凑 | 两个操作数不对称，限制寄存器个数，执行时钟周期差别大 |
| MM      | 目标代码紧凑，不需要寄存器保存变量                        | 指令字长变化大，每条指令工作差别大，存储器频繁访问  |

### 2.2

寻址方式：一种指令集结构如何确定所有访问的数据的地址

有效地址：由寻址方式确定的实际存储器地址

表2.4 操作数寻址方式

多种寻址方式：减少程序的指令条数 增加复杂度、CPI

立即数寻址方式、偏移寻址方式频度最高 一些性质31-32页

### 2.3

确定功能由什么实现，考虑的因素：速度、成本、灵活性

- 硬件：速度快、成本高、灵活性低
- 软件：速度低、成本低、灵活性高

指令集基本要求：

- 完整性
  - 有限可用的存储空间内，对于任何可解问题编程，指令集提供的指令足够使用
  - 功能齐全、使用方便
- 规整性
  - 对称性：所有与指令集相关的存储单元使用、操作码设置都是对称的
  - 均匀性：对各种不同的操作数类型、字长、操作种类和数据存储单元，指令设置要同等对待
- 高效率
  - 指令的执行速度快、使用频率高
- 兼容性


CISC指令集：

- 追求目标：强化指令功能、减少指令条数，以达到提高性能的目的
- 增强指令功能从以下几个方面：
  - 面向目标程序增强指令功能
    - 面向目标程序优化指令集释提高计算机性能的最直接的方法
    - 增强运算型指令功能
    - 增强数据传送指令的功能
    - 增强程序控制指令的功能
  - 面向高级语言的优化实现来改进指令集
    - 高级语言与一般的机器语言的语义差距非常大。一方面：编译器本身比较复杂；二方面：编译生成的目标代码比较难以达到好的优化
    - 增强对高级语言和编译器的支持（35页）
    - 使用高级语言计算机（36页）
    - 面向操作系统的优化实现改进指令集（36-37页）

CISC指令集存在的问题：

- 各种指令的使用频度相差悬殊，许多指令很少用到
- 指令集庞大，指令条数很多，许多指令的功能又很复杂
- 许多指令操作繁杂，CPI值比较大，执行速度慢；有可能使整个程序的执行时间反而增加
- 指令功能复杂，规整性不好，不利于采用流水技术来提高性能

RISC计算机设计遵循原则：

- 指令条数少而简单，只选取使用频度很高的指令
- 采用简单而统一的指令格式，减少寻址方式。字长32位or64位
- 指令的执行在单个机器周期内完成（流水线后）
- load和store才能访问存储器，采用load-store结构
- 大多数指令都采用硬连逻辑来实现
- 强调优化编译器的作用，为高级程序语言生成优化的代码
- 充分利用流水技术

早起RISC微处理器特点：

- load-store结构
- 字长为32位
- 高效的流水技术

控制指令

- 分类
  - 跳转：无条件改变控制流指令
  - 分支：有条件改变控制流指令
- 改变控制流的指令：条件分支、跳转、过程调用、过程返回（分支占大半部分）

3种表示分支条件的主要方法

| 名称      | 方法                           | 优点            | 缺点                                |
| ------- | ---------------------------- | ------------- | --------------------------------- |
| 条件码（CC） | 检测由ALU操作设置的一些特殊位(CC)         | 自由设置分支条件      | 条件码是增设的状态；限制了指令的执行顺序（确保条件码能够顺利传送） |
| 条件寄存器   | 比较指令把比较结果放入一个寄存器，需要的时候检测该寄存器 | 简单            | 占用了一个寄存器                          |
| 比较与分支   | 比较操作作为分支指令的一部分，通常这种比较是受限制的   | 一条指令（非两条）实现分支 | 流水方式时，该指令的操作太多，无法在一拍内做完           |

转移地址的表示（显式）

- 最常用的方法：指令中提供一个偏移量，偏移量加程序计数器(PC) — — PC相对寻址
  - 优点
    - 有效减少表示该目标地址所需的位数(一般目标地址离当前指令很近)
    - 位置无关(代码可以被转载到主存的任意位置)
  - 4～8位偏移量字段足够表示大多数转移目标地址

过程调用和返回

- 除了改变控制流，还要保存机器状态、返回地址(专门的链接寄存器、堆栈)
- 过去：专门的保存机制
- 现在：编译器生成load和store指令来保存或恢复寄存器

### 2.4

数据表示：计算机硬件能够直接识别、指令集可以直接调用的数据类型

数据结构：软件进行处理和实现的各种数据类型

如何确定数据表示：系统结构设计者要解决的问题（软硬件取舍折中）

表示操作数类型的方法

- 指令中操作码指定操作数的类型 常用
- 带标志符的数据表示 少见
- 41页

操作数大小

- 字节 8位；半字 16位；字 32位；双字 64 位
- 字符 ASCII码 一个字节
- 整数 二进制补码 字节、半字、字
- 浮点操作数 单精度浮点数 1个字；双精度浮点数 双字
- 十进制操作数类型 41页

访问频度 单字、双字的高

### 2.5

指令组成：操作码、地址码

指令格式的设计：确定指令字的编码方式，操作码和地址码的编码和表示方式

操作码：

- Huffman码，变长，不规整，不利于硬件处理
- 固定长度操作码，保证译码速度

寻址方式：

- 编码于操作码中，操作码描述寻址方式。load-store结构，寻址方式少
- 专门的地址描述符。多种寻址方式，指令操作数多

考虑因素：

- 寄存器个数、寻址方式的数目对指令平均字长的影响、目标代码大小的影响
- 指令易于硬件处理，特别是流水实现
- 指令字长是字节(8位)的整数倍

编码格式

- 变长编码格式
  - 寻址方式和操作种类很多时候，最好
  - 最少的二进制位来表示目标代码
  - 可能使各条指令的字长和执行时间差异很大
- 固定长度编码格式
  - 操作类型、寻址方式一起编码到操作码当中
  - 寻址方式和操作类型很少时，最好
  - 降低译码的复杂度，提高译码速度
  - RISC指令集采用该编码格式
- 混合型编码格式
  - 提供若干种固定的指令字长
  - 减少目标代码长度、降低译码复杂度日常的副本/第二章复习笔记的副本 3.md## 第二章

### 2.1

存储操作数的操作单元：堆栈、累加器、通用寄存器组

通用寄存器分为：RM结构、RR结构、MM结构（很少用）（R— 寄存器、M存储器）

通用寄存器优势（灵活性、提高性能方面）：

- 寄存器的访问速度比存储器快
- 对编译器而言，能更加容易、有效地分配和使用寄存器
- 寄存器可以用来存放变量

根据ALU指令的操作数个数，对通用寄存器型指令集进行进一步细分：

- ALU指令的操作数个数
- ALU指令的存储器操作数个数
- 具体表 28页表2.2

| 指令集结构类型 | 优点                                       | 缺点                         |
| ------- | ---------------------------------------- | -------------------------- |
| RR      | 指令字长固定，指令结构简洁，执行时钟周期数相近                  | 指令条数多，目标代码不够紧凑，程序占用空间大     |
| RM      | 可以在ALU指令中直接对存储器操作数进行引用，容易对指令进行编码，目标代码比较紧凑 | 两个操作数不对称，限制寄存器个数，执行时钟周期差别大 |
| MM      | 目标代码紧凑，不需要寄存器保存变量                        | 指令字长变化大，每条指令工作差别大，存储器频繁访问  |

### 2.2

寻址方式：一种指令集结构如何确定所有访问的数据的地址

有效地址：由寻址方式确定的实际存储器地址

表2.4 操作数寻址方式

多种寻址方式：减少程序的指令条数 增加复杂度、CPI

立即数寻址方式、偏移寻址方式频度最高 一些性质31-32页

### 2.3

确定功能由什么实现，考虑的因素：速度、成本、灵活性

- 硬件：速度快、成本高、灵活性低
- 软件：速度低、成本低、灵活性高

指令集基本要求：

- 完整性
  - 有限可用的存储空间内，对于任何可解问题编程，指令集提供的指令足够使用
  - 功能齐全、使用方便
- 规整性
  - 对称性：所有与指令集相关的存储单元使用、操作码设置都是对称的
  - 均匀性：对各种不同的操作数类型、字长、操作种类和数据存储单元，指令设置要同等对待
- 高效率
  - 指令的执行速度快、使用频率高
- 兼容性


CISC指令集：

- 追求目标：强化指令功能、减少指令条数，以达到提高性能的目的
- 增强指令功能从以下几个方面：
  - 面向目标程序增强指令功能
    - 面向目标程序优化指令集释提高计算机性能的最直接的方法
    - 增强运算型指令功能
    - 增强数据传送指令的功能
    - 增强程序控制指令的功能
  - 面向高级语言的优化实现来改进指令集
    - 高级语言与一般的机器语言的语义差距非常大。一方面：编译器本身比较复杂；二方面：编译生成的目标代码比较难以达到好的优化
    - 增强对高级语言和编译器的支持（35页）
    - 使用高级语言计算机（36页）
    - 面向操作系统的优化实现改进指令集（36-37页）

CISC指令集存在的问题：

- 各种指令的使用频度相差悬殊，许多指令很少用到
- 指令集庞大，指令条数很多，许多指令的功能又很复杂
- 许多指令操作繁杂，CPI值比较大，执行速度慢；有可能使整个程序的执行时间反而增加
- 指令功能复杂，规整性不好，不利于采用流水技术来提高性能

RISC计算机设计遵循原则：

- 指令条数少而简单，只选取使用频度很高的指令
- 采用简单而统一的指令格式，减少寻址方式。字长32位or64位
- 指令的执行在单个机器周期内完成（流水线后）
- load和store才能访问存储器，采用load-store结构
- 大多数指令都采用硬连逻辑来实现
- 强调优化编译器的作用，为高级程序语言生成优化的代码
- 充分利用流水技术

早起RISC微处理器特点：

- load-store结构
- 字长为32位
- 高效的流水技术

控制指令

- 分类
  - 跳转：无条件改变控制流指令
  - 分支：有条件改变控制流指令
- 改变控制流的指令：条件分支、跳转、过程调用、过程返回（分支占大半部分）

3种表示分支条件的主要方法

| 名称      | 方法                           | 优点            | 缺点                                |
| ------- | ---------------------------- | ------------- | --------------------------------- |
| 条件码（CC） | 检测由ALU操作设置的一些特殊位(CC)         | 自由设置分支条件      | 条件码是增设的状态；限制了指令的执行顺序（确保条件码能够顺利传送） |
| 条件寄存器   | 比较指令把比较结果放入一个寄存器，需要的时候检测该寄存器 | 简单            | 占用了一个寄存器                          |
| 比较与分支   | 比较操作作为分支指令的一部分，通常这种比较是受限制的   | 一条指令（非两条）实现分支 | 流水方式时，该指令的操作太多，无法在一拍内做完           |

转移地址的表示（显式）

- 最常用的方法：指令中提供一个偏移量，偏移量加程序计数器(PC) — — PC相对寻址
  - 优点
    - 有效减少表示该目标地址所需的位数(一般目标地址离当前指令很近)
    - 位置无关(代码可以被转载到主存的任意位置)
  - 4～8位偏移量字段足够表示大多数转移目标地址

过程调用和返回

- 除了改变控制流，还要保存机器状态、返回地址(专门的链接寄存器、堆栈)
- 过去：专门的保存机制
- 现在：编译器生成load和store指令来保存或恢复寄存器

### 2.4

数据表示：计算机硬件能够直接识别、指令集可以直接调用的数据类型

数据结构：软件进行处理和实现的各种数据类型

如何确定数据表示：系统结构设计者要解决的问题（软硬件取舍折中）

表示操作数类型的方法

- 指令中操作码指定操作数的类型 常用
- 带标志符的数据表示 少见
- 41页

操作数大小

- 字节 8位；半字 16位；字 32位；双字 64 位
- 字符 ASCII码 一个字节
- 整数 二进制补码 字节、半字、字
- 浮点操作数 单精度浮点数 1个字；双精度浮点数 双字
- 十进制操作数类型 41页

访问频度 单字、双字的高

### 2.5

指令组成：操作码、地址码

指令格式的设计：确定指令字的编码方式，操作码和地址码的编码和表示方式

操作码：

- Huffman码，变长，不规整，不利于硬件处理
- 固定长度操作码，保证译码速度

寻址方式：

- 编码于操作码中，操作码描述寻址方式。load-store结构，寻址方式少
- 专门的地址描述符。多种寻址方式，指令操作数多

考虑因素：

- 寄存器个数、寻址方式的数目对指令平均字长的影响、目标代码大小的影响
- 指令易于硬件处理，特别是流水实现
- 指令字长是字节(8位)的整数倍

编码格式

- 变长编码格式
  - 寻址方式和操作种类很多时候，最好
  - 最少的二进制位来表示目标代码
  - 可能使各条指令的字长和执行时间差异很大
- 固定长度编码格式
  - 操作类型、寻址方式一起编码到操作码当中
  - 寻址方式和操作类型很少时，最好
  - 降低译码的复杂度，提高译码速度
  - RISC指令集采用该编码格式
- 混合型编码格式
  - 提供若干种固定的指令字长
  - 减少目标代码长度、降低译码复杂度日常的副本/第二章复习笔记的副本.md## 第二章

### 2.1

存储操作数的操作单元：堆栈、累加器、通用寄存器组

通用寄存器分为：RM结构、RR结构、MM结构（很少用）（R— 寄存器、M存储器）

通用寄存器优势（灵活性、提高性能方面）：

- 寄存器的访问速度比存储器快
- 对编译器而言，能更加容易、有效地分配和使用寄存器
- 寄存器可以用来存放变量

根据ALU指令的操作数个数，对通用寄存器型指令集进行进一步细分：

- ALU指令的操作数个数
- ALU指令的存储器操作数个数
- 具体表 28页表2.2

| 指令集结构类型 | 优点                                       | 缺点                         |
| ------- | ---------------------------------------- | -------------------------- |
| RR      | 指令字长固定，指令结构简洁，执行时钟周期数相近                  | 指令条数多，目标代码不够紧凑，程序占用空间大     |
| RM      | 可以在ALU指令中直接对存储器操作数进行引用，容易对指令进行编码，目标代码比较紧凑 | 两个操作数不对称，限制寄存器个数，执行时钟周期差别大 |
| MM      | 目标代码紧凑，不需要寄存器保存变量                        | 指令字长变化大，每条指令工作差别大，存储器频繁访问  |

### 2.2

寻址方式：一种指令集结构如何确定所有访问的数据的地址

有效地址：由寻址方式确定的实际存储器地址

表2.4 操作数寻址方式

多种寻址方式：减少程序的指令条数 增加复杂度、CPI

立即数寻址方式、偏移寻址方式频度最高 一些性质31-32页

### 2.3

确定功能由什么实现，考虑的因素：速度、成本、灵活性

- 硬件：速度快、成本高、灵活性低
- 软件：速度低、成本低、灵活性高

指令集基本要求：

- 完整性
  - 有限可用的存储空间内，对于任何可解问题编程，指令集提供的指令足够使用
  - 功能齐全、使用方便
- 规整性
  - 对称性：所有与指令集相关的存储单元使用、操作码设置都是对称的
  - 均匀性：对各种不同的操作数类型、字长、操作种类和数据存储单元，指令设置要同等对待
- 高效率
  - 指令的执行速度快、使用频率高
- 兼容性


CISC指令集：

- 追求目标：强化指令功能、减少指令条数，以达到提高性能的目的
- 增强指令功能从以下几个方面：
  - 面向目标程序增强指令功能
    - 面向目标程序优化指令集释提高计算机性能的最直接的方法
    - 增强运算型指令功能
    - 增强数据传送指令的功能
    - 增强程序控制指令的功能
  - 面向高级语言的优化实现来改进指令集
    - 高级语言与一般的机器语言的语义差距非常大。一方面：编译器本身比较复杂；二方面：编译生成的目标代码比较难以达到好的优化
    - 增强对高级语言和编译器的支持（35页）
    - 使用高级语言计算机（36页）
    - 面向操作系统的优化实现改进指令集（36-37页）

CISC指令集存在的问题：

- 各种指令的使用频度相差悬殊，许多指令很少用到
- 指令集庞大，指令条数很多，许多指令的功能又很复杂
- 许多指令操作繁杂，CPI值比较大，执行速度慢；有可能使整个程序的执行时间反而增加
- 指令功能复杂，规整性不好，不利于采用流水技术来提高性能

RISC计算机设计遵循原则：

- 指令条数少而简单，只选取使用频度很高的指令
- 采用简单而统一的指令格式，减少寻址方式。字长32位or64位
- 指令的执行在单个机器周期内完成（流水线后）
- load和store才能访问存储器，采用load-store结构
- 大多数指令都采用硬连逻辑来实现
- 强调优化编译器的作用，为高级程序语言生成优化的代码
- 充分利用流水技术

早起RISC微处理器特点：

- load-store结构
- 字长为32位
- 高效的流水技术

控制指令

- 分类
  - 跳转：无条件改变控制流指令
  - 分支：有条件改变控制流指令
- 改变控制流的指令：条件分支、跳转、过程调用、过程返回（分支占大半部分）

3种表示分支条件的主要方法

| 名称      | 方法                           | 优点            | 缺点                                |
| ------- | ---------------------------- | ------------- | --------------------------------- |
| 条件码（CC） | 检测由ALU操作设置的一些特殊位(CC)         | 自由设置分支条件      | 条件码是增设的状态；限制了指令的执行顺序（确保条件码能够顺利传送） |
| 条件寄存器   | 比较指令把比较结果放入一个寄存器，需要的时候检测该寄存器 | 简单            | 占用了一个寄存器                          |
| 比较与分支   | 比较操作作为分支指令的一部分，通常这种比较是受限制的   | 一条指令（非两条）实现分支 | 流水方式时，该指令的操作太多，无法在一拍内做完           |

转移地址的表示（显式）

- 最常用的方法：指令中提供一个偏移量，偏移量加程序计数器(PC) — — PC相对寻址
  - 优点
    - 有效减少表示该目标地址所需的位数(一般目标地址离当前指令很近)
    - 位置无关(代码可以被转载到主存的任意位置)
  - 4～8位偏移量字段足够表示大多数转移目标地址

过程调用和返回

- 除了改变控制流，还要保存机器状态、返回地址(专门的链接寄存器、堆栈)
- 过去：专门的保存机制
- 现在：编译器生成load和store指令来保存或恢复寄存器

### 2.4

数据表示：计算机硬件能够直接识别、指令集可以直接调用的数据类型

数据结构：软件进行处理和实现的各种数据类型

如何确定数据表示：系统结构设计者要解决的问题（软硬件取舍折中）

表示操作数类型的方法

- 指令中操作码指定操作数的类型 常用
- 带标志符的数据表示 少见
- 41页

操作数大小

- 字节 8位；半字 16位；字 32位；双字 64 位
- 字符 ASCII码 一个字节
- 整数 二进制补码 字节、半字、字
- 浮点操作数 单精度浮点数 1个字；双精度浮点数 双字
- 十进制操作数类型 41页

访问频度 单字、双字的高

### 2.5

指令组成：操作码、地址码

指令格式的设计：确定指令字的编码方式，操作码和地址码的编码和表示方式

操作码：

- Huffman码，变长，不规整，不利于硬件处理
- 固定长度操作码，保证译码速度

寻址方式：

- 编码于操作码中，操作码描述寻址方式。load-store结构，寻址方式少
- 专门的地址描述符。多种寻址方式，指令操作数多

考虑因素：

- 寄存器个数、寻址方式的数目对指令平均字长的影响、目标代码大小的影响
- 指令易于硬件处理，特别是流水实现
- 指令字长是字节(8位)的整数倍

编码格式

- 变长编码格式
  - 寻址方式和操作种类很多时候，最好
  - 最少的二进制位来表示目标代码
  - 可能使各条指令的字长和执行时间差异很大
- 固定长度编码格式
  - 操作类型、寻址方式一起编码到操作码当中
  - 寻址方式和操作类型很少时，最好
  - 降低译码的复杂度，提高译码速度
  - RISC指令集采用该编码格式
- 混合型编码格式
  - 提供若干种固定的指令字长
  - 减少目标代码长度、降低译码复杂度日常的副本 2/request-ok 结构.md# request-ok 结构

## Activities 

- 登录
- 

### 登录
用户填写表单提交登录，登录成功跳转主页

### 主页
显示用户监听页面的列表
每个页面的历史扫描情况
用户出现
对监听页面用户可以进行编辑或查找

### 查找
在主页搜索栏输入关键字查找记录


## Models
### User
用户个人信息
- name
- pages：用户添加的 pages，User 跟 Page关系多对多

### Page
待扫描页面的信息
- url
- title
- records：record 的列表
- header
- frequency：扫描间隔时间（秒）
- author：修改者
- modify-log：配置信息

### Record
一条扫描记录
- reqSent：发出的请求列表
- reqReceived：收到的请求列表
- startTimeStamp：扫描创建时间
- finishTimeStamp：扫描结束时间
- match：bool，收发请求是否一一对应

### RequestSent
一条发出的请求
- requestId
- url
- header

### RequestReceived
一条收到的请求
- requestId
- status：状态码
- statusText：状态文本
- url：请求的 url
- response-header
- time：请求耗时

### Relation维护用户和页面间多对多关系

日常的副本 2/测试文章.md# title

## subtitle

hello *there*
  * w
  * x
  * y
  * z

## node
```node
function () {
  return 1; // what?
}
```

## c++
```c++
#include <iostream>
using namespace std;
int main () {
  cout << 'hello world';
  return 0
}
```

## image
![here](scr.png)
![here](blog.svg)
![vuejob](https://zh.nuxtjs.org/vuejobs.png)

## link
[here](scr.png)
日常的副本 2/第一章复习笔记.md## 第一章

### 术语挑选

- **虚拟机**：用软件实现的机器。

- **翻译、解释**

- **计算机系统结构**：传统机器程序员所看到的计算机属性，即概念性结构与功能特性。

- **透明性**：在计算机技术中，把这种本来存在的事物或属性，但从某种角度看又好像不存在的概念称为透明性。

- **计算机组成**：计算机系统结构的逻辑实现，包含物理机器级中的数据流和控制流的组成以及逻辑设计等。着眼于物理机器级內**各事件的排序方式和控制方式、各部件的功能和部件之间的联系**

- **计算机实现**：计算机组成的物理实现。着眼于**器件**和**微组装技术**。

- **Amdahl定律**：当对一个系统中的某个部件进行改进后，所能获得的整个系统性能的提高，受限于该部件的执行时间占总执行时间的百分比。

- **系列机**：由同一厂家生产的具有相同系统结构、但具有不同组成和实现的一系列不同型号的计算机。

- **模拟**，**仿真**

- **并行性**：计算机系统在同一时刻或者同一时间间隔内进行多种运算或操作。只要在时间上相互重叠，就存在并行性。它包括同时性与并发性两种含义。

  - **时间重叠**：在并行性概念中引入<u>时间因素</u>，让多个处理过程在时间上相互错开，轮流重叠地使用同一套硬件设备的各个部分，以加快硬件周转而赢得速度。

    **资源重复**：在并行性概念中引入<u>空间因素</u>，以数量取胜。通过重复设置硬件资源，大幅度地提高计算机系统的性能。

    **资源共享**：这是一种软件方法，它使多个任务按一定时间顺序轮流使用同一套硬件设备。

- **异构型多处理机系统**：由多个不同类型、至少担负不同功能的处理机组成，它们按照作业要求的顺序，利用时间重叠原理，依次对它们的多个任务进行加工，各自完成规定的功能动作。

  **同构型多处理机系统**：由多个同类型或至少担负同等功能的处理机组成，它们同时处理同一作业中能并行执行的多个任务。



### 1.1

2002年后，计算机性能下降的原因：

- 功耗问题
- 可开发的指令集并行性很少
- 存储器访问速度提升缓慢

因而-> **多核**， 开发**线程级并行** 和 **数据集并行**



### 1.2 系统结构概念

按照**计算机语言**的角度->计算机系统按功能划分成 **多级层次结构**，每一层以一种语言为特征。

按照计算机系统的多级层次结构，不同级程序员看到的计算机具有不同的属性。

**广义的系统结构定义**：指令集结构、组成、硬件

- 传统机器语言级程序员看到的属性：
  - 指令系统、数据表示、寻址规则、寄存器定义、终端系统、工作转台的定义和切换、存储系统、信息保护、IO结构

计算机系统结构概念的**实质**：确定软、硬件的界面

**计算机组成、实现**：一种体系结构可以有多种组成，一种组成可以有多种物理实现。

计算机系统结构的**分类**：

- Flynn：**指令流**和**数据流**的多倍性进行分类

  指令流：计算机执行的指令序列。

  数据流：由指令条用的数据序列

  多倍性：在系统受限的部件下，同时处于同一执行阶段的指令和数据的最大数目。

  - SISD SIMD MISD MIMD

- 冯氏：系统最大并行度（m*n）



### 1.3 定量分析技术

4个定量原理：

1. 经常性时间为重点。

   对经常发生的情况采用优化方法的原则进行选择，得到更多总体上的改进。

   **优化**：分配更多资源、达到更高性能或者分配更多的电能？

2. Amdahl定律

   加快某部件的执行速度对于系统总体性能的提升，受限于该部件执行时间占总执行时间的百分比。

   概念：加速比、可改进比例 \< 1、部件加速比 \>1

   **一种性能改进的递减规则**

   **重要推论**：如果只针对整个任务的一部分进行改进和优化，那么所获得的加速比不超过
   $$

   $$

   $$
   \frac{1}{1-可改进比例}
   $$




3. CPU性能公式

   CPU时间 = IC * CPI * 时钟周期时间

   CPU时钟周期数 = $\sum (CPI_i \times IC_i)$

   **CPI = $\sum (CPI_i \times \frac{IC_i}{IC})$**

4. 程序的局部性原理

   程序执行时所访问的存储器地址分布不是随机

   的，而是相对地簇聚

   - 时间局部性
   - 空间局部性

性能评测：

1. 执行时间：

   - 全部时间
   - CPU时间：CPU执行所给定的程序所花费的时间，不包含I/O等待时间以及运行其他程序的时间。
     - 用户CPU时间
     - 系统CPU时间：用户程序运行期间操作系统耗费的CPU时间

   吞吐率：单位时间的任务量

2. 基准测试程序

   基准测试程序套件: SPEC系列

   事务处理性能测试基准程序（TP）



### 1.4 发展

冯诺依曼结构：

1. 存储程序原理的**基本点**：**指令驱动**
2. 主要特点：
   - 以运算器为中心
   - 在存储器中，指令和数据同等对待
   - 存储器是按地址访问、按顺序线性编址的一堆结构，每个单元的位数是固定的
   - 指令执行顺序
   - 指令=操作码+地址码
   - 二进制表示、运算
3. 改进
   - 输入输出方式：
     - 程序控制：等待、中断
     - DMA
     - IO处理机
   - 并行处理
   - 存储器
   - 指令集

软件的可移植性：

- 系列机

  **向后兼容**是系列机的**根本特征**。

- 模拟、仿真

- 统一高级语言

摩尔定律：集成电路芯片晶体管数 18个月翻番

**应用需求** 是 促使计算机系统结构发展的最根本的**动力**

计算机性能随时间下移



### 1.5 并行性

并行性：计算机系统在同一时刻或同一时间间隔内进行多种运算或操作。

- 同时性：时刻
- 并发行：时间间隔

处理数据的角度：字串位串->全并行（字并位并）

执行程序的角度：指令内部、指令级、现成绩、任务级、作业级

- 三种途径：

  - 时间重叠（主导作用）

    - 部件功能专用化->流水线

  - 资源重复

    - 多提存储器
    - 多操作部件->指令集并行

  - 资源共享

    单处理机模拟多处理机的功能（虚拟机）

    - 分时系统

3种多处理机：

- 异构型多处理机

  不用类型、至少担负不同功能的处理机组成，按照要求的顺序，**利用时间重叠原理**，多个任务进行加工，完成**各自功能**。

- 同构性多处理机

  同类型，至少担负同种功能的，同时处理统一作业中能并行的多个任务。

- 分布式系统日常的副本 2/第三章复习笔记.md## 第三章

### 名词解释

- **流水线**：将一个重复的时序过程，分解成为若干个子过程，而每一个子过程都可有效地在其专用功能段上与其它子过程同时执行

- **数据相关**：考虑两条指令i和j，*i*在*j*的前面，如果下述条件之一成立，则称指令*j*与指令i数据相关： 

  （1）指令*j*使用指令*i*产生的结果；

  （2）指令*j*与指令*k*数据相关，而指令*k*又与指令*i*数据相关。

- **名相关**：如果两条指令使用了相同的名，但是它们之间并没有数据流动，则称这两条指令存在名相关。

- **反相关**：考虑两条指令*i*和*j*，*i*在*j*的前面，如果指令*j*所写的名与指令*i*所读的名相同，则称指令*i*和*j*发生了反相关。

- **输出相关**：考虑两条指令*i*和*j*，*i*在*j*的前面，如果指令*j*和指令*i*所写的名相同，则称指令*i*和*j*发生了输出相关。

- **结构冲突**：因硬件资源满足不了指令重叠执行的要求而发生的冲突。

- **数据冲突**：当指令在流水线中重叠执行时，因需要用到前面指令的执行结果而发生的冲突。

- **控制冲突**：流水线遇到分支指令或其它会改变PC值的指令所引起的冲突。

- **定向**：用来解决写后读冲突的。

- **写后读冲突**

  **写后写冲突**、**读后写冲突** （经典5段不会出现的）

- **链接技术**：具有先写后读相关的两条指令，在不出现功能部件冲突和Vi冲突的情况下，可以把功能部件链接起来进行流水处理，以达到加快执行的目的。

- **分段开采**：当向量的长度大于向量寄存器的长度时，必须把长向量分成长度固定的段，然后循环分段处理，每一次循环只处理一个向量段。

### 3.1 流水线基本概念

- 流水线技术

  - 流水线的**级**或**段**
  - 流水线的**深度**

- 流水线特点

  - 分解为多个子过程，专门的功能部件

  - 各段时间相等

    时间长的段成为流水线的**瓶颈**

  - 功能部件后面又一个缓冲寄存器（锁存器）-> **流水寄存器**

    **作用**：相邻两段之间<u>传送数据</u>，保证提供后面要用到的数据，各段的处理工作<u>相互隔离</u>

  - 大量的时序过程，才能发挥效率

  - **通过时间**和**排空时间**

    第一个和最后一个，从进入到流出所需要的时间

- 分类

  - 单功能、多功能（ASC）

  - 静态流水线、动态流水线

  - 部件级流水线（运算操作流水线）

    处理机级流水线（指令流水线）

    处理机间流水线（宏流水线）

  - 线性流水线、非线性流水线

    - 非线性 调度问题，争用流水段

  - 顺序流水线、乱序流水线（无序、错序、异步）

  - 标量处理机、向量处理机

### 3.2 性能指标

- **吞吐率TP** 

  单位时间完成的任务数量或输出结果的数量

  - 实际，最大

  解决**流水线瓶颈**的方法

  - **细分瓶颈段**
  - **重复设置瓶颈段**

- **加速比S**

  不使用流水线和使用流水线所用的时间比

  最大加速比 = k

  流水线的段数并非越多越好。

- **效率E**

  流水线中设备实际使用时间与整个运行时间的比值。（数面积）

问题：

- 瓶颈问题

- 额外开销

  - 流水寄存器延迟

    建立时间：信号到达前，寄存器保持稳定的时间

    传输延迟：信号到达后，寄存器输出可用的时间

  - 时钟偏移开销

    时钟到达各流水寄存器的最大差值时间

  时钟周期小到与额外开销相同时，流水已没有意义。

- 冲突问题—最重要的问题之一

### 3.3 相关与冲突

5段RICS：IF -> ID -> EX -> MEM -> WB

- **相关**

  两条指令之间在某种依赖关系

  - 数据相关

  - 名相关 （i写j读）

    相同的名，但没有数据流动

    - 反相关 （i读j写）
    - 输出相关（i写j写）

  - 控制相关

- **流水线冲突**

  - **结构冲突**

    原因：

    - 功能部件不是完全流水的
    - 资源份数不够

    访存冲突：

    1. 插入暂停周期（流水线气泡）

    2. 设置独立的指令、数据存储器

       或者独立的指令、数据Cache

    语序结构冲突的存在：成本

  - **数据冲突**

    靠太近

    - RAW 写后读

    - WAW 写后写

      只发生在：

      - 流水线不止一个段可以写
      - 当前停顿，后续可以前进

      5段里面不存在的

    - WAR 读后写

      只发生在：

      - 有的写提前、有的读滞后
      - 重新排序

      依然不存在的

    **定向技术**

    - 将计算结果从其**产生的地方**直接送到其他指令**需要它的地方**，那么就可以避免停顿

    - 然而，定向并不能解决所有问题，比如：LD->DADD

      增加**互锁硬件**，插入暂停

      作用：检测发现数据冲突，使流水线停顿

    **指令调度**／**流水线调度**

    让编译器重新组织顺序

  - **控制冲突**

    简单方法：冻结、排空（3个周期的延迟）

    **分支延迟**：由分支指令引起的

    假设：**判断转移成功**和**确定目标地址**都在**ID**段完成->分支延迟为一个周期

    3种编译器减少延迟的方法：（静态）

    - **预测分支失败**

      - 确定失败，不跳转，一切正常

      - 确定成功，跳转，之前的指令转化为空操作

        保重能够退回原先的状态

    - **预测分支成功**

      - 前提：先知道跳转的目标地址

        对5段流水线没有任何好处

    - **延迟分支**

      延迟分支指令的执行时间，加上**延迟槽**

      - 从前调度
      - 从目标出调度
      - 从失败处调度

      **分支取消机制**

### 3.4 实现--MIPS

- 流水寄存器

- 所有的数据冲突可以在ID段检测到，流出ID前暂停->互锁

  load互锁

  检测到RAW冲突，IF、ID段的指令不再前进：

  - ID/EX.IR中的操作吗改为0
  - IF/ID寄存器的内容回送到自己的入口

- ID段增设加法器

- 条件测试移到ID段

- 结果送回IF段的MUX1

  ​日常的副本 2/第二章复习笔记.md## 第二章

### 2.1

存储操作数的操作单元：堆栈、累加器、通用寄存器组

通用寄存器分为：RM结构、RR结构、MM结构（很少用）（R— 寄存器、M存储器）

通用寄存器优势（灵活性、提高性能方面）：

- 寄存器的访问速度比存储器快
- 对编译器而言，能更加容易、有效地分配和使用寄存器
- 寄存器可以用来存放变量

根据ALU指令的操作数个数，对通用寄存器型指令集进行进一步细分：

- ALU指令的操作数个数
- ALU指令的存储器操作数个数
- 具体表 28页表2.2

| 指令集结构类型 | 优点                                       | 缺点                         |
| ------- | ---------------------------------------- | -------------------------- |
| RR      | 指令字长固定，指令结构简洁，执行时钟周期数相近                  | 指令条数多，目标代码不够紧凑，程序占用空间大     |
| RM      | 可以在ALU指令中直接对存储器操作数进行引用，容易对指令进行编码，目标代码比较紧凑 | 两个操作数不对称，限制寄存器个数，执行时钟周期差别大 |
| MM      | 目标代码紧凑，不需要寄存器保存变量                        | 指令字长变化大，每条指令工作差别大，存储器频繁访问  |

### 2.2

寻址方式：一种指令集结构如何确定所有访问的数据的地址

有效地址：由寻址方式确定的实际存储器地址

表2.4 操作数寻址方式

多种寻址方式：减少程序的指令条数 增加复杂度、CPI

立即数寻址方式、偏移寻址方式频度最高 一些性质31-32页

### 2.3

确定功能由什么实现，考虑的因素：速度、成本、灵活性

- 硬件：速度快、成本高、灵活性低
- 软件：速度低、成本低、灵活性高

指令集基本要求：

- 完整性
  - 有限可用的存储空间内，对于任何可解问题编程，指令集提供的指令足够使用
  - 功能齐全、使用方便
- 规整性
  - 对称性：所有与指令集相关的存储单元使用、操作码设置都是对称的
  - 均匀性：对各种不同的操作数类型、字长、操作种类和数据存储单元，指令设置要同等对待
- 高效率
  - 指令的执行速度快、使用频率高
- 兼容性


CISC指令集：

- 追求目标：强化指令功能、减少指令条数，以达到提高性能的目的
- 增强指令功能从以下几个方面：
  - 面向目标程序增强指令功能
    - 面向目标程序优化指令集释提高计算机性能的最直接的方法
    - 增强运算型指令功能
    - 增强数据传送指令的功能
    - 增强程序控制指令的功能
  - 面向高级语言的优化实现来改进指令集
    - 高级语言与一般的机器语言的语义差距非常大。一方面：编译器本身比较复杂；二方面：编译生成的目标代码比较难以达到好的优化
    - 增强对高级语言和编译器的支持（35页）
    - 使用高级语言计算机（36页）
    - 面向操作系统的优化实现改进指令集（36-37页）

CISC指令集存在的问题：

- 各种指令的使用频度相差悬殊，许多指令很少用到
- 指令集庞大，指令条数很多，许多指令的功能又很复杂
- 许多指令操作繁杂，CPI值比较大，执行速度慢；有可能使整个程序的执行时间反而增加
- 指令功能复杂，规整性不好，不利于采用流水技术来提高性能

RISC计算机设计遵循原则：

- 指令条数少而简单，只选取使用频度很高的指令
- 采用简单而统一的指令格式，减少寻址方式。字长32位or64位
- 指令的执行在单个机器周期内完成（流水线后）
- load和store才能访问存储器，采用load-store结构
- 大多数指令都采用硬连逻辑来实现
- 强调优化编译器的作用，为高级程序语言生成优化的代码
- 充分利用流水技术

早起RISC微处理器特点：

- load-store结构
- 字长为32位
- 高效的流水技术

控制指令

- 分类
  - 跳转：无条件改变控制流指令
  - 分支：有条件改变控制流指令
- 改变控制流的指令：条件分支、跳转、过程调用、过程返回（分支占大半部分）

3种表示分支条件的主要方法

| 名称      | 方法                           | 优点            | 缺点                                |
| ------- | ---------------------------- | ------------- | --------------------------------- |
| 条件码（CC） | 检测由ALU操作设置的一些特殊位(CC)         | 自由设置分支条件      | 条件码是增设的状态；限制了指令的执行顺序（确保条件码能够顺利传送） |
| 条件寄存器   | 比较指令把比较结果放入一个寄存器，需要的时候检测该寄存器 | 简单            | 占用了一个寄存器                          |
| 比较与分支   | 比较操作作为分支指令的一部分，通常这种比较是受限制的   | 一条指令（非两条）实现分支 | 流水方式时，该指令的操作太多，无法在一拍内做完           |

转移地址的表示（显式）

- 最常用的方法：指令中提供一个偏移量，偏移量加程序计数器(PC) — — PC相对寻址
  - 优点
    - 有效减少表示该目标地址所需的位数(一般目标地址离当前指令很近)
    - 位置无关(代码可以被转载到主存的任意位置)
  - 4～8位偏移量字段足够表示大多数转移目标地址

过程调用和返回

- 除了改变控制流，还要保存机器状态、返回地址(专门的链接寄存器、堆栈)
- 过去：专门的保存机制
- 现在：编译器生成load和store指令来保存或恢复寄存器

### 2.4

数据表示：计算机硬件能够直接识别、指令集可以直接调用的数据类型

数据结构：软件进行处理和实现的各种数据类型

如何确定数据表示：系统结构设计者要解决的问题（软硬件取舍折中）

表示操作数类型的方法

- 指令中操作码指定操作数的类型 常用
- 带标志符的数据表示 少见
- 41页

操作数大小

- 字节 8位；半字 16位；字 32位；双字 64 位
- 字符 ASCII码 一个字节
- 整数 二进制补码 字节、半字、字
- 浮点操作数 单精度浮点数 1个字；双精度浮点数 双字
- 十进制操作数类型 41页

访问频度 单字、双字的高

### 2.5

指令组成：操作码、地址码

指令格式的设计：确定指令字的编码方式，操作码和地址码的编码和表示方式

操作码：

- Huffman码，变长，不规整，不利于硬件处理
- 固定长度操作码，保证译码速度

寻址方式：

- 编码于操作码中，操作码描述寻址方式。load-store结构，寻址方式少
- 专门的地址描述符。多种寻址方式，指令操作数多

考虑因素：

- 寄存器个数、寻址方式的数目对指令平均字长的影响、目标代码大小的影响
- 指令易于硬件处理，特别是流水实现
- 指令字长是字节(8位)的整数倍

编码格式

- 变长编码格式
  - 寻址方式和操作种类很多时候，最好
  - 最少的二进制位来表示目标代码
  - 可能使各条指令的字长和执行时间差异很大
- 固定长度编码格式
  - 操作类型、寻址方式一起编码到操作码当中
  - 寻址方式和操作类型很少时，最好
  - 降低译码的复杂度，提高译码速度
  - RISC指令集采用该编码格式
- 混合型编码格式
  - 提供若干种固定的指令字长
  - 减少目标代码长度、降低译码复杂度日常的副本 3/request-ok 结构.md# request-ok 结构

## Activities 

- 登录
- 

### 登录
用户填写表单提交登录，登录成功跳转主页

### 主页
显示用户监听页面的列表
每个页面的历史扫描情况
用户出现
对监听页面用户可以进行编辑或查找

### 查找
在主页搜索栏输入关键字查找记录


## Models
### User
用户个人信息
- name
- pages：用户添加的 pages，User 跟 Page关系多对多

### Page
待扫描页面的信息
- url
- title
- records：record 的列表
- header
- frequency：扫描间隔时间（秒）
- author：修改者
- modify-log：配置信息

### Record
一条扫描记录
- reqSent：发出的请求列表
- reqReceived：收到的请求列表
- startTimeStamp：扫描创建时间
- finishTimeStamp：扫描结束时间
- match：bool，收发请求是否一一对应

### RequestSent
一条发出的请求
- requestId
- url
- header

### RequestReceived
一条收到的请求
- requestId
- status：状态码
- statusText：状态文本
- url：请求的 url
- response-header
- time：请求耗时

### Relation维护用户和页面间多对多关系

日常的副本 3/测试文章.md# title

## subtitle

hello *there*
  * w
  * x
  * y
  * z

## node
```node
function () {
  return 1; // what?
}
```

## c++
```c++
#include <iostream>
using namespace std;
int main () {
  cout << 'hello world';
  return 0
}
```

## image
![here](scr.png)
![here](blog.svg)
![vuejob](https://zh.nuxtjs.org/vuejobs.png)

## link
[here](scr.png)
日常的副本 3/第一章复习笔记.md## 第一章

### 术语挑选

- **虚拟机**：用软件实现的机器。

- **翻译、解释**

- **计算机系统结构**：传统机器程序员所看到的计算机属性，即概念性结构与功能特性。

- **透明性**：在计算机技术中，把这种本来存在的事物或属性，但从某种角度看又好像不存在的概念称为透明性。

- **计算机组成**：计算机系统结构的逻辑实现，包含物理机器级中的数据流和控制流的组成以及逻辑设计等。着眼于物理机器级內**各事件的排序方式和控制方式、各部件的功能和部件之间的联系**

- **计算机实现**：计算机组成的物理实现。着眼于**器件**和**微组装技术**。

- **Amdahl定律**：当对一个系统中的某个部件进行改进后，所能获得的整个系统性能的提高，受限于该部件的执行时间占总执行时间的百分比。

- **系列机**：由同一厂家生产的具有相同系统结构、但具有不同组成和实现的一系列不同型号的计算机。

- **模拟**，**仿真**

- **并行性**：计算机系统在同一时刻或者同一时间间隔内进行多种运算或操作。只要在时间上相互重叠，就存在并行性。它包括同时性与并发性两种含义。

  - **时间重叠**：在并行性概念中引入<u>时间因素</u>，让多个处理过程在时间上相互错开，轮流重叠地使用同一套硬件设备的各个部分，以加快硬件周转而赢得速度。

    **资源重复**：在并行性概念中引入<u>空间因素</u>，以数量取胜。通过重复设置硬件资源，大幅度地提高计算机系统的性能。

    **资源共享**：这是一种软件方法，它使多个任务按一定时间顺序轮流使用同一套硬件设备。

- **异构型多处理机系统**：由多个不同类型、至少担负不同功能的处理机组成，它们按照作业要求的顺序，利用时间重叠原理，依次对它们的多个任务进行加工，各自完成规定的功能动作。

  **同构型多处理机系统**：由多个同类型或至少担负同等功能的处理机组成，它们同时处理同一作业中能并行执行的多个任务。



### 1.1

2002年后，计算机性能下降的原因：

- 功耗问题
- 可开发的指令集并行性很少
- 存储器访问速度提升缓慢

因而-> **多核**， 开发**线程级并行** 和 **数据集并行**



### 1.2 系统结构概念

按照**计算机语言**的角度->计算机系统按功能划分成 **多级层次结构**，每一层以一种语言为特征。

按照计算机系统的多级层次结构，不同级程序员看到的计算机具有不同的属性。

**广义的系统结构定义**：指令集结构、组成、硬件

- 传统机器语言级程序员看到的属性：
  - 指令系统、数据表示、寻址规则、寄存器定义、终端系统、工作转台的定义和切换、存储系统、信息保护、IO结构

计算机系统结构概念的**实质**：确定软、硬件的界面

**计算机组成、实现**：一种体系结构可以有多种组成，一种组成可以有多种物理实现。

计算机系统结构的**分类**：

- Flynn：**指令流**和**数据流**的多倍性进行分类

  指令流：计算机执行的指令序列。

  数据流：由指令条用的数据序列

  多倍性：在系统受限的部件下，同时处于同一执行阶段的指令和数据的最大数目。

  - SISD SIMD MISD MIMD

- 冯氏：系统最大并行度（m*n）



### 1.3 定量分析技术

4个定量原理：

1. 经常性时间为重点。

   对经常发生的情况采用优化方法的原则进行选择，得到更多总体上的改进。

   **优化**：分配更多资源、达到更高性能或者分配更多的电能？

2. Amdahl定律

   加快某部件的执行速度对于系统总体性能的提升，受限于该部件执行时间占总执行时间的百分比。

   概念：加速比、可改进比例 \< 1、部件加速比 \>1

   **一种性能改进的递减规则**

   **重要推论**：如果只针对整个任务的一部分进行改进和优化，那么所获得的加速比不超过
   $$

   $$

   $$
   \frac{1}{1-可改进比例}
   $$




3. CPU性能公式

   CPU时间 = IC * CPI * 时钟周期时间

   CPU时钟周期数 = $\sum (CPI_i \times IC_i)$

   **CPI = $\sum (CPI_i \times \frac{IC_i}{IC})$**

4. 程序的局部性原理

   程序执行时所访问的存储器地址分布不是随机

   的，而是相对地簇聚

   - 时间局部性
   - 空间局部性

性能评测：

1. 执行时间：

   - 全部时间
   - CPU时间：CPU执行所给定的程序所花费的时间，不包含I/O等待时间以及运行其他程序的时间。
     - 用户CPU时间
     - 系统CPU时间：用户程序运行期间操作系统耗费的CPU时间

   吞吐率：单位时间的任务量

2. 基准测试程序

   基准测试程序套件: SPEC系列

   事务处理性能测试基准程序（TP）



### 1.4 发展

冯诺依曼结构：

1. 存储程序原理的**基本点**：**指令驱动**
2. 主要特点：
   - 以运算器为中心
   - 在存储器中，指令和数据同等对待
   - 存储器是按地址访问、按顺序线性编址的一堆结构，每个单元的位数是固定的
   - 指令执行顺序
   - 指令=操作码+地址码
   - 二进制表示、运算
3. 改进
   - 输入输出方式：
     - 程序控制：等待、中断
     - DMA
     - IO处理机
   - 并行处理
   - 存储器
   - 指令集

软件的可移植性：

- 系列机

  **向后兼容**是系列机的**根本特征**。

- 模拟、仿真

- 统一高级语言

摩尔定律：集成电路芯片晶体管数 18个月翻番

**应用需求** 是 促使计算机系统结构发展的最根本的**动力**

计算机性能随时间下移



### 1.5 并行性

并行性：计算机系统在同一时刻或同一时间间隔内进行多种运算或操作。

- 同时性：时刻
- 并发行：时间间隔

处理数据的角度：字串位串->全并行（字并位并）

执行程序的角度：指令内部、指令级、现成绩、任务级、作业级

- 三种途径：

  - 时间重叠（主导作用）

    - 部件功能专用化->流水线

  - 资源重复

    - 多提存储器
    - 多操作部件->指令集并行

  - 资源共享

    单处理机模拟多处理机的功能（虚拟机）

    - 分时系统

3种多处理机：

- 异构型多处理机

  不用类型、至少担负不同功能的处理机组成，按照要求的顺序，**利用时间重叠原理**，多个任务进行加工，完成**各自功能**。

- 同构性多处理机

  同类型，至少担负同种功能的，同时处理统一作业中能并行的多个任务。

- 分布式系统日常的副本 3/第三章复习笔记.md## 第三章

### 名词解释

- **流水线**：将一个重复的时序过程，分解成为若干个子过程，而每一个子过程都可有效地在其专用功能段上与其它子过程同时执行

- **数据相关**：考虑两条指令i和j，*i*在*j*的前面，如果下述条件之一成立，则称指令*j*与指令i数据相关： 

  （1）指令*j*使用指令*i*产生的结果；

  （2）指令*j*与指令*k*数据相关，而指令*k*又与指令*i*数据相关。

- **名相关**：如果两条指令使用了相同的名，但是它们之间并没有数据流动，则称这两条指令存在名相关。

- **反相关**：考虑两条指令*i*和*j*，*i*在*j*的前面，如果指令*j*所写的名与指令*i*所读的名相同，则称指令*i*和*j*发生了反相关。

- **输出相关**：考虑两条指令*i*和*j*，*i*在*j*的前面，如果指令*j*和指令*i*所写的名相同，则称指令*i*和*j*发生了输出相关。

- **结构冲突**：因硬件资源满足不了指令重叠执行的要求而发生的冲突。

- **数据冲突**：当指令在流水线中重叠执行时，因需要用到前面指令的执行结果而发生的冲突。

- **控制冲突**：流水线遇到分支指令或其它会改变PC值的指令所引起的冲突。

- **定向**：用来解决写后读冲突的。

- **写后读冲突**

  **写后写冲突**、**读后写冲突** （经典5段不会出现的）

- **链接技术**：具有先写后读相关的两条指令，在不出现功能部件冲突和Vi冲突的情况下，可以把功能部件链接起来进行流水处理，以达到加快执行的目的。

- **分段开采**：当向量的长度大于向量寄存器的长度时，必须把长向量分成长度固定的段，然后循环分段处理，每一次循环只处理一个向量段。

### 3.1 流水线基本概念

- 流水线技术

  - 流水线的**级**或**段**
  - 流水线的**深度**

- 流水线特点

  - 分解为多个子过程，专门的功能部件

  - 各段时间相等

    时间长的段成为流水线的**瓶颈**

  - 功能部件后面又一个缓冲寄存器（锁存器）-> **流水寄存器**

    **作用**：相邻两段之间<u>传送数据</u>，保证提供后面要用到的数据，各段的处理工作<u>相互隔离</u>

  - 大量的时序过程，才能发挥效率

  - **通过时间**和**排空时间**

    第一个和最后一个，从进入到流出所需要的时间

- 分类

  - 单功能、多功能（ASC）

  - 静态流水线、动态流水线

  - 部件级流水线（运算操作流水线）

    处理机级流水线（指令流水线）

    处理机间流水线（宏流水线）

  - 线性流水线、非线性流水线

    - 非线性 调度问题，争用流水段

  - 顺序流水线、乱序流水线（无序、错序、异步）

  - 标量处理机、向量处理机

### 3.2 性能指标

- **吞吐率TP** 

  单位时间完成的任务数量或输出结果的数量

  - 实际，最大

  解决**流水线瓶颈**的方法

  - **细分瓶颈段**
  - **重复设置瓶颈段**

- **加速比S**

  不使用流水线和使用流水线所用的时间比

  最大加速比 = k

  流水线的段数并非越多越好。

- **效率E**

  流水线中设备实际使用时间与整个运行时间的比值。（数面积）

问题：

- 瓶颈问题

- 额外开销

  - 流水寄存器延迟

    建立时间：信号到达前，寄存器保持稳定的时间

    传输延迟：信号到达后，寄存器输出可用的时间

  - 时钟偏移开销

    时钟到达各流水寄存器的最大差值时间

  时钟周期小到与额外开销相同时，流水已没有意义。

- 冲突问题—最重要的问题之一

### 3.3 相关与冲突

5段RICS：IF -> ID -> EX -> MEM -> WB

- **相关**

  两条指令之间在某种依赖关系

  - 数据相关

  - 名相关 （i写j读）

    相同的名，但没有数据流动

    - 反相关 （i读j写）
    - 输出相关（i写j写）

  - 控制相关

- **流水线冲突**

  - **结构冲突**

    原因：

    - 功能部件不是完全流水的
    - 资源份数不够

    访存冲突：

    1. 插入暂停周期（流水线气泡）

    2. 设置独立的指令、数据存储器

       或者独立的指令、数据Cache

    语序结构冲突的存在：成本

  - **数据冲突**

    靠太近

    - RAW 写后读

    - WAW 写后写

      只发生在：

      - 流水线不止一个段可以写
      - 当前停顿，后续可以前进

      5段里面不存在的

    - WAR 读后写

      只发生在：

      - 有的写提前、有的读滞后
      - 重新排序

      依然不存在的

    **定向技术**

    - 将计算结果从其**产生的地方**直接送到其他指令**需要它的地方**，那么就可以避免停顿

    - 然而，定向并不能解决所有问题，比如：LD->DADD

      增加**互锁硬件**，插入暂停

      作用：检测发现数据冲突，使流水线停顿

    **指令调度**／**流水线调度**

    让编译器重新组织顺序

  - **控制冲突**

    简单方法：冻结、排空（3个周期的延迟）

    **分支延迟**：由分支指令引起的

    假设：**判断转移成功**和**确定目标地址**都在**ID**段完成->分支延迟为一个周期

    3种编译器减少延迟的方法：（静态）

    - **预测分支失败**

      - 确定失败，不跳转，一切正常

      - 确定成功，跳转，之前的指令转化为空操作

        保重能够退回原先的状态

    - **预测分支成功**

      - 前提：先知道跳转的目标地址

        对5段流水线没有任何好处

    - **延迟分支**

      延迟分支指令的执行时间，加上**延迟槽**

      - 从前调度
      - 从目标出调度
      - 从失败处调度

      **分支取消机制**

### 3.4 实现--MIPS

- 流水寄存器

- 所有的数据冲突可以在ID段检测到，流出ID前暂停->互锁

  load互锁

  检测到RAW冲突，IF、ID段的指令不再前进：

  - ID/EX.IR中的操作吗改为0
  - IF/ID寄存器的内容回送到自己的入口

- ID段增设加法器

- 条件测试移到ID段

- 结果送回IF段的MUX1

  ​日常的副本 3/第二章复习笔记.md## 第二章

### 2.1

存储操作数的操作单元：堆栈、累加器、通用寄存器组

通用寄存器分为：RM结构、RR结构、MM结构（很少用）（R— 寄存器、M存储器）

通用寄存器优势（灵活性、提高性能方面）：

- 寄存器的访问速度比存储器快
- 对编译器而言，能更加容易、有效地分配和使用寄存器
- 寄存器可以用来存放变量

根据ALU指令的操作数个数，对通用寄存器型指令集进行进一步细分：

- ALU指令的操作数个数
- ALU指令的存储器操作数个数
- 具体表 28页表2.2

| 指令集结构类型 | 优点                                       | 缺点                         |
| ------- | ---------------------------------------- | -------------------------- |
| RR      | 指令字长固定，指令结构简洁，执行时钟周期数相近                  | 指令条数多，目标代码不够紧凑，程序占用空间大     |
| RM      | 可以在ALU指令中直接对存储器操作数进行引用，容易对指令进行编码，目标代码比较紧凑 | 两个操作数不对称，限制寄存器个数，执行时钟周期差别大 |
| MM      | 目标代码紧凑，不需要寄存器保存变量                        | 指令字长变化大，每条指令工作差别大，存储器频繁访问  |

### 2.2

寻址方式：一种指令集结构如何确定所有访问的数据的地址

有效地址：由寻址方式确定的实际存储器地址

表2.4 操作数寻址方式

多种寻址方式：减少程序的指令条数 增加复杂度、CPI

立即数寻址方式、偏移寻址方式频度最高 一些性质31-32页

### 2.3

确定功能由什么实现，考虑的因素：速度、成本、灵活性

- 硬件：速度快、成本高、灵活性低
- 软件：速度低、成本低、灵活性高

指令集基本要求：

- 完整性
  - 有限可用的存储空间内，对于任何可解问题编程，指令集提供的指令足够使用
  - 功能齐全、使用方便
- 规整性
  - 对称性：所有与指令集相关的存储单元使用、操作码设置都是对称的
  - 均匀性：对各种不同的操作数类型、字长、操作种类和数据存储单元，指令设置要同等对待
- 高效率
  - 指令的执行速度快、使用频率高
- 兼容性


CISC指令集：

- 追求目标：强化指令功能、减少指令条数，以达到提高性能的目的
- 增强指令功能从以下几个方面：
  - 面向目标程序增强指令功能
    - 面向目标程序优化指令集释提高计算机性能的最直接的方法
    - 增强运算型指令功能
    - 增强数据传送指令的功能
    - 增强程序控制指令的功能
  - 面向高级语言的优化实现来改进指令集
    - 高级语言与一般的机器语言的语义差距非常大。一方面：编译器本身比较复杂；二方面：编译生成的目标代码比较难以达到好的优化
    - 增强对高级语言和编译器的支持（35页）
    - 使用高级语言计算机（36页）
    - 面向操作系统的优化实现改进指令集（36-37页）

CISC指令集存在的问题：

- 各种指令的使用频度相差悬殊，许多指令很少用到
- 指令集庞大，指令条数很多，许多指令的功能又很复杂
- 许多指令操作繁杂，CPI值比较大，执行速度慢；有可能使整个程序的执行时间反而增加
- 指令功能复杂，规整性不好，不利于采用流水技术来提高性能

RISC计算机设计遵循原则：

- 指令条数少而简单，只选取使用频度很高的指令
- 采用简单而统一的指令格式，减少寻址方式。字长32位or64位
- 指令的执行在单个机器周期内完成（流水线后）
- load和store才能访问存储器，采用load-store结构
- 大多数指令都采用硬连逻辑来实现
- 强调优化编译器的作用，为高级程序语言生成优化的代码
- 充分利用流水技术

早起RISC微处理器特点：

- load-store结构
- 字长为32位
- 高效的流水技术

控制指令

- 分类
  - 跳转：无条件改变控制流指令
  - 分支：有条件改变控制流指令
- 改变控制流的指令：条件分支、跳转、过程调用、过程返回（分支占大半部分）

3种表示分支条件的主要方法

| 名称      | 方法                           | 优点            | 缺点                                |
| ------- | ---------------------------- | ------------- | --------------------------------- |
| 条件码（CC） | 检测由ALU操作设置的一些特殊位(CC)         | 自由设置分支条件      | 条件码是增设的状态；限制了指令的执行顺序（确保条件码能够顺利传送） |
| 条件寄存器   | 比较指令把比较结果放入一个寄存器，需要的时候检测该寄存器 | 简单            | 占用了一个寄存器                          |
| 比较与分支   | 比较操作作为分支指令的一部分，通常这种比较是受限制的   | 一条指令（非两条）实现分支 | 流水方式时，该指令的操作太多，无法在一拍内做完           |

转移地址的表示（显式）

- 最常用的方法：指令中提供一个偏移量，偏移量加程序计数器(PC) — — PC相对寻址
  - 优点
    - 有效减少表示该目标地址所需的位数(一般目标地址离当前指令很近)
    - 位置无关(代码可以被转载到主存的任意位置)
  - 4～8位偏移量字段足够表示大多数转移目标地址

过程调用和返回

- 除了改变控制流，还要保存机器状态、返回地址(专门的链接寄存器、堆栈)
- 过去：专门的保存机制
- 现在：编译器生成load和store指令来保存或恢复寄存器

### 2.4

数据表示：计算机硬件能够直接识别、指令集可以直接调用的数据类型

数据结构：软件进行处理和实现的各种数据类型

如何确定数据表示：系统结构设计者要解决的问题（软硬件取舍折中）

表示操作数类型的方法

- 指令中操作码指定操作数的类型 常用
- 带标志符的数据表示 少见
- 41页

操作数大小

- 字节 8位；半字 16位；字 32位；双字 64 位
- 字符 ASCII码 一个字节
- 整数 二进制补码 字节、半字、字
- 浮点操作数 单精度浮点数 1个字；双精度浮点数 双字
- 十进制操作数类型 41页

访问频度 单字、双字的高

### 2.5

指令组成：操作码、地址码

指令格式的设计：确定指令字的编码方式，操作码和地址码的编码和表示方式

操作码：

- Huffman码，变长，不规整，不利于硬件处理
- 固定长度操作码，保证译码速度

寻址方式：

- 编码于操作码中，操作码描述寻址方式。load-store结构，寻址方式少
- 专门的地址描述符。多种寻址方式，指令操作数多

考虑因素：

- 寄存器个数、寻址方式的数目对指令平均字长的影响、目标代码大小的影响
- 指令易于硬件处理，特别是流水实现
- 指令字长是字节(8位)的整数倍

编码格式

- 变长编码格式
  - 寻址方式和操作种类很多时候，最好
  - 最少的二进制位来表示目标代码
  - 可能使各条指令的字长和执行时间差异很大
- 固定长度编码格式
  - 操作类型、寻址方式一起编码到操作码当中
  - 寻址方式和操作类型很少时，最好
  - 降低译码的复杂度，提高译码速度
  - RISC指令集采用该编码格式
- 混合型编码格式
  - 提供若干种固定的指令字长
  - 减少目标代码长度、降低译码复杂度日常的副本 4/request-ok 结构.md# request-ok 结构

## Activities 

- 登录
- 

### 登录
用户填写表单提交登录，登录成功跳转主页

### 主页
显示用户监听页面的列表
每个页面的历史扫描情况
用户出现
对监听页面用户可以进行编辑或查找

### 查找
在主页搜索栏输入关键字查找记录


## Models
### User
用户个人信息
- name
- pages：用户添加的 pages，User 跟 Page关系多对多

### Page
待扫描页面的信息
- url
- title
- records：record 的列表
- header
- frequency：扫描间隔时间（秒）
- author：修改者
- modify-log：配置信息

### Record
一条扫描记录
- reqSent：发出的请求列表
- reqReceived：收到的请求列表
- startTimeStamp：扫描创建时间
- finishTimeStamp：扫描结束时间
- match：bool，收发请求是否一一对应

### RequestSent
一条发出的请求
- requestId
- url
- header

### RequestReceived
一条收到的请求
- requestId
- status：状态码
- statusText：状态文本
- url：请求的 url
- response-header
- time：请求耗时

### Relation维护用户和页面间多对多关系

日常的副本 4/测试文章.md# title

## subtitle

hello *there*
  * w
  * x
  * y
  * z

## node
```node
function () {
  return 1; // what?
}
```

## c++
```c++
#include <iostream>
using namespace std;
int main () {
  cout << 'hello world';
  return 0
}
```

## image
![here](scr.png)
![here](blog.svg)
![vuejob](https://zh.nuxtjs.org/vuejobs.png)

## link
[here](scr.png)
日常的副本 4/第一章复习笔记.md## 第一章

### 术语挑选

- **虚拟机**：用软件实现的机器。

- **翻译、解释**

- **计算机系统结构**：传统机器程序员所看到的计算机属性，即概念性结构与功能特性。

- **透明性**：在计算机技术中，把这种本来存在的事物或属性，但从某种角度看又好像不存在的概念称为透明性。

- **计算机组成**：计算机系统结构的逻辑实现，包含物理机器级中的数据流和控制流的组成以及逻辑设计等。着眼于物理机器级內**各事件的排序方式和控制方式、各部件的功能和部件之间的联系**

- **计算机实现**：计算机组成的物理实现。着眼于**器件**和**微组装技术**。

- **Amdahl定律**：当对一个系统中的某个部件进行改进后，所能获得的整个系统性能的提高，受限于该部件的执行时间占总执行时间的百分比。

- **系列机**：由同一厂家生产的具有相同系统结构、但具有不同组成和实现的一系列不同型号的计算机。

- **模拟**，**仿真**

- **并行性**：计算机系统在同一时刻或者同一时间间隔内进行多种运算或操作。只要在时间上相互重叠，就存在并行性。它包括同时性与并发性两种含义。

  - **时间重叠**：在并行性概念中引入<u>时间因素</u>，让多个处理过程在时间上相互错开，轮流重叠地使用同一套硬件设备的各个部分，以加快硬件周转而赢得速度。

    **资源重复**：在并行性概念中引入<u>空间因素</u>，以数量取胜。通过重复设置硬件资源，大幅度地提高计算机系统的性能。

    **资源共享**：这是一种软件方法，它使多个任务按一定时间顺序轮流使用同一套硬件设备。

- **异构型多处理机系统**：由多个不同类型、至少担负不同功能的处理机组成，它们按照作业要求的顺序，利用时间重叠原理，依次对它们的多个任务进行加工，各自完成规定的功能动作。

  **同构型多处理机系统**：由多个同类型或至少担负同等功能的处理机组成，它们同时处理同一作业中能并行执行的多个任务。



### 1.1

2002年后，计算机性能下降的原因：

- 功耗问题
- 可开发的指令集并行性很少
- 存储器访问速度提升缓慢

因而-> **多核**， 开发**线程级并行** 和 **数据集并行**



### 1.2 系统结构概念

按照**计算机语言**的角度->计算机系统按功能划分成 **多级层次结构**，每一层以一种语言为特征。

按照计算机系统的多级层次结构，不同级程序员看到的计算机具有不同的属性。

**广义的系统结构定义**：指令集结构、组成、硬件

- 传统机器语言级程序员看到的属性：
  - 指令系统、数据表示、寻址规则、寄存器定义、终端系统、工作转台的定义和切换、存储系统、信息保护、IO结构

计算机系统结构概念的**实质**：确定软、硬件的界面

**计算机组成、实现**：一种体系结构可以有多种组成，一种组成可以有多种物理实现。

计算机系统结构的**分类**：

- Flynn：**指令流**和**数据流**的多倍性进行分类

  指令流：计算机执行的指令序列。

  数据流：由指令条用的数据序列

  多倍性：在系统受限的部件下，同时处于同一执行阶段的指令和数据的最大数目。

  - SISD SIMD MISD MIMD

- 冯氏：系统最大并行度（m*n）



### 1.3 定量分析技术

4个定量原理：

1. 经常性时间为重点。

   对经常发生的情况采用优化方法的原则进行选择，得到更多总体上的改进。

   **优化**：分配更多资源、达到更高性能或者分配更多的电能？

2. Amdahl定律

   加快某部件的执行速度对于系统总体性能的提升，受限于该部件执行时间占总执行时间的百分比。

   概念：加速比、可改进比例 \< 1、部件加速比 \>1

   **一种性能改进的递减规则**

   **重要推论**：如果只针对整个任务的一部分进行改进和优化，那么所获得的加速比不超过
   $$

   $$

   $$
   \frac{1}{1-可改进比例}
   $$




3. CPU性能公式

   CPU时间 = IC * CPI * 时钟周期时间

   CPU时钟周期数 = $\sum (CPI_i \times IC_i)$

   **CPI = $\sum (CPI_i \times \frac{IC_i}{IC})$**

4. 程序的局部性原理

   程序执行时所访问的存储器地址分布不是随机

   的，而是相对地簇聚

   - 时间局部性
   - 空间局部性

性能评测：

1. 执行时间：

   - 全部时间
   - CPU时间：CPU执行所给定的程序所花费的时间，不包含I/O等待时间以及运行其他程序的时间。
     - 用户CPU时间
     - 系统CPU时间：用户程序运行期间操作系统耗费的CPU时间

   吞吐率：单位时间的任务量

2. 基准测试程序

   基准测试程序套件: SPEC系列

   事务处理性能测试基准程序（TP）



### 1.4 发展

冯诺依曼结构：

1. 存储程序原理的**基本点**：**指令驱动**
2. 主要特点：
   - 以运算器为中心
   - 在存储器中，指令和数据同等对待
   - 存储器是按地址访问、按顺序线性编址的一堆结构，每个单元的位数是固定的
   - 指令执行顺序
   - 指令=操作码+地址码
   - 二进制表示、运算
3. 改进
   - 输入输出方式：
     - 程序控制：等待、中断
     - DMA
     - IO处理机
   - 并行处理
   - 存储器
   - 指令集

软件的可移植性：

- 系列机

  **向后兼容**是系列机的**根本特征**。

- 模拟、仿真

- 统一高级语言

摩尔定律：集成电路芯片晶体管数 18个月翻番

**应用需求** 是 促使计算机系统结构发展的最根本的**动力**

计算机性能随时间下移



### 1.5 并行性

并行性：计算机系统在同一时刻或同一时间间隔内进行多种运算或操作。

- 同时性：时刻
- 并发行：时间间隔

处理数据的角度：字串位串->全并行（字并位并）

执行程序的角度：指令内部、指令级、现成绩、任务级、作业级

- 三种途径：

  - 时间重叠（主导作用）

    - 部件功能专用化->流水线

  - 资源重复

    - 多提存储器
    - 多操作部件->指令集并行

  - 资源共享

    单处理机模拟多处理机的功能（虚拟机）

    - 分时系统

3种多处理机：

- 异构型多处理机

  不用类型、至少担负不同功能的处理机组成，按照要求的顺序，**利用时间重叠原理**，多个任务进行加工，完成**各自功能**。

- 同构性多处理机

  同类型，至少担负同种功能的，同时处理统一作业中能并行的多个任务。

- 分布式系统日常的副本 4/第三章复习笔记.md## 第三章

### 名词解释

- **流水线**：将一个重复的时序过程，分解成为若干个子过程，而每一个子过程都可有效地在其专用功能段上与其它子过程同时执行

- **数据相关**：考虑两条指令i和j，*i*在*j*的前面，如果下述条件之一成立，则称指令*j*与指令i数据相关： 

  （1）指令*j*使用指令*i*产生的结果；

  （2）指令*j*与指令*k*数据相关，而指令*k*又与指令*i*数据相关。

- **名相关**：如果两条指令使用了相同的名，但是它们之间并没有数据流动，则称这两条指令存在名相关。

- **反相关**：考虑两条指令*i*和*j*，*i*在*j*的前面，如果指令*j*所写的名与指令*i*所读的名相同，则称指令*i*和*j*发生了反相关。

- **输出相关**：考虑两条指令*i*和*j*，*i*在*j*的前面，如果指令*j*和指令*i*所写的名相同，则称指令*i*和*j*发生了输出相关。

- **结构冲突**：因硬件资源满足不了指令重叠执行的要求而发生的冲突。

- **数据冲突**：当指令在流水线中重叠执行时，因需要用到前面指令的执行结果而发生的冲突。

- **控制冲突**：流水线遇到分支指令或其它会改变PC值的指令所引起的冲突。

- **定向**：用来解决写后读冲突的。

- **写后读冲突**

  **写后写冲突**、**读后写冲突** （经典5段不会出现的）

- **链接技术**：具有先写后读相关的两条指令，在不出现功能部件冲突和Vi冲突的情况下，可以把功能部件链接起来进行流水处理，以达到加快执行的目的。

- **分段开采**：当向量的长度大于向量寄存器的长度时，必须把长向量分成长度固定的段，然后循环分段处理，每一次循环只处理一个向量段。

### 3.1 流水线基本概念

- 流水线技术

  - 流水线的**级**或**段**
  - 流水线的**深度**

- 流水线特点

  - 分解为多个子过程，专门的功能部件

  - 各段时间相等

    时间长的段成为流水线的**瓶颈**

  - 功能部件后面又一个缓冲寄存器（锁存器）-> **流水寄存器**

    **作用**：相邻两段之间<u>传送数据</u>，保证提供后面要用到的数据，各段的处理工作<u>相互隔离</u>

  - 大量的时序过程，才能发挥效率

  - **通过时间**和**排空时间**

    第一个和最后一个，从进入到流出所需要的时间

- 分类

  - 单功能、多功能（ASC）

  - 静态流水线、动态流水线

  - 部件级流水线（运算操作流水线）

    处理机级流水线（指令流水线）

    处理机间流水线（宏流水线）

  - 线性流水线、非线性流水线

    - 非线性 调度问题，争用流水段

  - 顺序流水线、乱序流水线（无序、错序、异步）

  - 标量处理机、向量处理机

### 3.2 性能指标

- **吞吐率TP** 

  单位时间完成的任务数量或输出结果的数量

  - 实际，最大

  解决**流水线瓶颈**的方法

  - **细分瓶颈段**
  - **重复设置瓶颈段**

- **加速比S**

  不使用流水线和使用流水线所用的时间比

  最大加速比 = k

  流水线的段数并非越多越好。

- **效率E**

  流水线中设备实际使用时间与整个运行时间的比值。（数面积）

问题：

- 瓶颈问题

- 额外开销

  - 流水寄存器延迟

    建立时间：信号到达前，寄存器保持稳定的时间

    传输延迟：信号到达后，寄存器输出可用的时间

  - 时钟偏移开销

    时钟到达各流水寄存器的最大差值时间

  时钟周期小到与额外开销相同时，流水已没有意义。

- 冲突问题—最重要的问题之一

### 3.3 相关与冲突

5段RICS：IF -> ID -> EX -> MEM -> WB

- **相关**

  两条指令之间在某种依赖关系

  - 数据相关

  - 名相关 （i写j读）

    相同的名，但没有数据流动

    - 反相关 （i读j写）
    - 输出相关（i写j写）

  - 控制相关

- **流水线冲突**

  - **结构冲突**

    原因：

    - 功能部件不是完全流水的
    - 资源份数不够

    访存冲突：

    1. 插入暂停周期（流水线气泡）

    2. 设置独立的指令、数据存储器

       或者独立的指令、数据Cache

    语序结构冲突的存在：成本

  - **数据冲突**

    靠太近

    - RAW 写后读

    - WAW 写后写

      只发生在：

      - 流水线不止一个段可以写
      - 当前停顿，后续可以前进

      5段里面不存在的

    - WAR 读后写

      只发生在：

      - 有的写提前、有的读滞后
      - 重新排序

      依然不存在的

    **定向技术**

    - 将计算结果从其**产生的地方**直接送到其他指令**需要它的地方**，那么就可以避免停顿

    - 然而，定向并不能解决所有问题，比如：LD->DADD

      增加**互锁硬件**，插入暂停

      作用：检测发现数据冲突，使流水线停顿

    **指令调度**／**流水线调度**

    让编译器重新组织顺序

  - **控制冲突**

    简单方法：冻结、排空（3个周期的延迟）

    **分支延迟**：由分支指令引起的

    假设：**判断转移成功**和**确定目标地址**都在**ID**段完成->分支延迟为一个周期

    3种编译器减少延迟的方法：（静态）

    - **预测分支失败**

      - 确定失败，不跳转，一切正常

      - 确定成功，跳转，之前的指令转化为空操作

        保重能够退回原先的状态

    - **预测分支成功**

      - 前提：先知道跳转的目标地址

        对5段流水线没有任何好处

    - **延迟分支**

      延迟分支指令的执行时间，加上**延迟槽**

      - 从前调度
      - 从目标出调度
      - 从失败处调度

      **分支取消机制**

### 3.4 实现--MIPS

- 流水寄存器

- 所有的数据冲突可以在ID段检测到，流出ID前暂停->互锁

  load互锁

  检测到RAW冲突，IF、ID段的指令不再前进：

  - ID/EX.IR中的操作吗改为0
  - IF/ID寄存器的内容回送到自己的入口

- ID段增设加法器

- 条件测试移到ID段

- 结果送回IF段的MUX1

  ​日常的副本 4/第二章复习笔记.md## 第二章

### 2.1

存储操作数的操作单元：堆栈、累加器、通用寄存器组

通用寄存器分为：RM结构、RR结构、MM结构（很少用）（R— 寄存器、M存储器）

通用寄存器优势（灵活性、提高性能方面）：

- 寄存器的访问速度比存储器快
- 对编译器而言，能更加容易、有效地分配和使用寄存器
- 寄存器可以用来存放变量

根据ALU指令的操作数个数，对通用寄存器型指令集进行进一步细分：

- ALU指令的操作数个数
- ALU指令的存储器操作数个数
- 具体表 28页表2.2

| 指令集结构类型 | 优点                                       | 缺点                         |
| ------- | ---------------------------------------- | -------------------------- |
| RR      | 指令字长固定，指令结构简洁，执行时钟周期数相近                  | 指令条数多，目标代码不够紧凑，程序占用空间大     |
| RM      | 可以在ALU指令中直接对存储器操作数进行引用，容易对指令进行编码，目标代码比较紧凑 | 两个操作数不对称，限制寄存器个数，执行时钟周期差别大 |
| MM      | 目标代码紧凑，不需要寄存器保存变量                        | 指令字长变化大，每条指令工作差别大，存储器频繁访问  |

### 2.2

寻址方式：一种指令集结构如何确定所有访问的数据的地址

有效地址：由寻址方式确定的实际存储器地址

表2.4 操作数寻址方式

多种寻址方式：减少程序的指令条数 增加复杂度、CPI

立即数寻址方式、偏移寻址方式频度最高 一些性质31-32页

### 2.3

确定功能由什么实现，考虑的因素：速度、成本、灵活性

- 硬件：速度快、成本高、灵活性低
- 软件：速度低、成本低、灵活性高

指令集基本要求：

- 完整性
  - 有限可用的存储空间内，对于任何可解问题编程，指令集提供的指令足够使用
  - 功能齐全、使用方便
- 规整性
  - 对称性：所有与指令集相关的存储单元使用、操作码设置都是对称的
  - 均匀性：对各种不同的操作数类型、字长、操作种类和数据存储单元，指令设置要同等对待
- 高效率
  - 指令的执行速度快、使用频率高
- 兼容性


CISC指令集：

- 追求目标：强化指令功能、减少指令条数，以达到提高性能的目的
- 增强指令功能从以下几个方面：
  - 面向目标程序增强指令功能
    - 面向目标程序优化指令集释提高计算机性能的最直接的方法
    - 增强运算型指令功能
    - 增强数据传送指令的功能
    - 增强程序控制指令的功能
  - 面向高级语言的优化实现来改进指令集
    - 高级语言与一般的机器语言的语义差距非常大。一方面：编译器本身比较复杂；二方面：编译生成的目标代码比较难以达到好的优化
    - 增强对高级语言和编译器的支持（35页）
    - 使用高级语言计算机（36页）
    - 面向操作系统的优化实现改进指令集（36-37页）

CISC指令集存在的问题：

- 各种指令的使用频度相差悬殊，许多指令很少用到
- 指令集庞大，指令条数很多，许多指令的功能又很复杂
- 许多指令操作繁杂，CPI值比较大，执行速度慢；有可能使整个程序的执行时间反而增加
- 指令功能复杂，规整性不好，不利于采用流水技术来提高性能

RISC计算机设计遵循原则：

- 指令条数少而简单，只选取使用频度很高的指令
- 采用简单而统一的指令格式，减少寻址方式。字长32位or64位
- 指令的执行在单个机器周期内完成（流水线后）
- load和store才能访问存储器，采用load-store结构
- 大多数指令都采用硬连逻辑来实现
- 强调优化编译器的作用，为高级程序语言生成优化的代码
- 充分利用流水技术

早起RISC微处理器特点：

- load-store结构
- 字长为32位
- 高效的流水技术

控制指令

- 分类
  - 跳转：无条件改变控制流指令
  - 分支：有条件改变控制流指令
- 改变控制流的指令：条件分支、跳转、过程调用、过程返回（分支占大半部分）

3种表示分支条件的主要方法

| 名称      | 方法                           | 优点            | 缺点                                |
| ------- | ---------------------------- | ------------- | --------------------------------- |
| 条件码（CC） | 检测由ALU操作设置的一些特殊位(CC)         | 自由设置分支条件      | 条件码是增设的状态；限制了指令的执行顺序（确保条件码能够顺利传送） |
| 条件寄存器   | 比较指令把比较结果放入一个寄存器，需要的时候检测该寄存器 | 简单            | 占用了一个寄存器                          |
| 比较与分支   | 比较操作作为分支指令的一部分，通常这种比较是受限制的   | 一条指令（非两条）实现分支 | 流水方式时，该指令的操作太多，无法在一拍内做完           |

转移地址的表示（显式）

- 最常用的方法：指令中提供一个偏移量，偏移量加程序计数器(PC) — — PC相对寻址
  - 优点
    - 有效减少表示该目标地址所需的位数(一般目标地址离当前指令很近)
    - 位置无关(代码可以被转载到主存的任意位置)
  - 4～8位偏移量字段足够表示大多数转移目标地址

过程调用和返回

- 除了改变控制流，还要保存机器状态、返回地址(专门的链接寄存器、堆栈)
- 过去：专门的保存机制
- 现在：编译器生成load和store指令来保存或恢复寄存器

### 2.4

数据表示：计算机硬件能够直接识别、指令集可以直接调用的数据类型

数据结构：软件进行处理和实现的各种数据类型

如何确定数据表示：系统结构设计者要解决的问题（软硬件取舍折中）

表示操作数类型的方法

- 指令中操作码指定操作数的类型 常用
- 带标志符的数据表示 少见
- 41页

操作数大小

- 字节 8位；半字 16位；字 32位；双字 64 位
- 字符 ASCII码 一个字节
- 整数 二进制补码 字节、半字、字
- 浮点操作数 单精度浮点数 1个字；双精度浮点数 双字
- 十进制操作数类型 41页

访问频度 单字、双字的高

### 2.5

指令组成：操作码、地址码

指令格式的设计：确定指令字的编码方式，操作码和地址码的编码和表示方式

操作码：

- Huffman码，变长，不规整，不利于硬件处理
- 固定长度操作码，保证译码速度

寻址方式：

- 编码于操作码中，操作码描述寻址方式。load-store结构，寻址方式少
- 专门的地址描述符。多种寻址方式，指令操作数多

考虑因素：

- 寄存器个数、寻址方式的数目对指令平均字长的影响、目标代码大小的影响
- 指令易于硬件处理，特别是流水实现
- 指令字长是字节(8位)的整数倍

编码格式

- 变长编码格式
  - 寻址方式和操作种类很多时候，最好
  - 最少的二进制位来表示目标代码
  - 可能使各条指令的字长和执行时间差异很大
- 固定长度编码格式
  - 操作类型、寻址方式一起编码到操作码当中
  - 寻址方式和操作类型很少时，最好
  - 降低译码的复杂度，提高译码速度
  - RISC指令集采用该编码格式
- 混合型编码格式
  - 提供若干种固定的指令字长
  - 减少目标代码长度、降低译码复杂度
    </body>
    </html>
  